
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Club Dashboard | Spaces</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #ec3750;
            --primary-rgb: 236, 55, 80;
            --primary-dark: #cf142b;
            --primary-light: #ff5a69;

            --bg-light: #f8f9fa;
            --bg-dark: #1f2d3d;

            --text-light: #333333;
            --text-dark: #ffffff;

            --sidebar-light: #ffffff;
            --sidebar-dark: #2c3e50;

            --card-light: #ffffff;
            --card-dark: #2c3e50;

            --border-light: #e5e7eb;
            --border-dark: #4b5563;

            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;

            --shadow-light: 0 4px 6px rgba(0, 0, 0, 0.05);
            --shadow-dark: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        [data-theme="light"] {
            --bg: var(--bg-light);
            --text: var(--text-light);
            --sidebar: var(--sidebar-light);
            --card: var(--card-light);
            --border: var(--border-light);
            --shadow: var(--shadow-light);
        }

        [data-theme="dark"] {
            --bg: var(--bg-dark);
            --text: var(--text-dark);
            --sidebar: var(--sidebar-dark);
            --card: var(--card-dark);
            --border: var(--border-dark);
            --shadow: var(--shadow-dark);
            color-scheme: dark;
        }
        
        /* Ensure form elements work in dark mode */
        [data-theme="dark"] .form-input,
        [data-theme="dark"] .form-textarea,
        [data-theme="dark"] .form-select {
            background-color: var(--card);
            color: var(--text);
        }
        
        /* Fix modals in dark mode */
        [data-theme="dark"] .modal-content {
            background-color: var(--card);
            color: var(--text);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: background-color 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
            z-index: 100;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            background-color: rgba(var(--primary-rgb), 0.1);
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar);
            border-right: 1px solid var(--border);
            position: fixed;
            height: 100vh;
            z-index: 10;
            transition: all 0.3s;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .sidebar-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-menu {
            list-style: none;
            padding: 1rem 0;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            gap: 0.75rem;
        }

        .nav-link:hover {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
        }

        .nav-link.active {
            border-left-color: var(--primary);
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
            font-weight: 500;
        }

        .user-info {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.9375rem;
            color: var(--text);
        }

        .user-email {
            font-size: 0.8125rem;
            color: var(--text);
            opacity: 0.8;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            margin-left: 250px;
            transition: margin-left 0.3s;
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .welcome-subtitle {
            font-size: 1.125rem;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--card);
            border-radius: 12px;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            overflow: hidden;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            flex-shrink: 0;
        }

        .card-icon-members {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .card-icon-meetings {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
        }

        .card-icon-finances {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .card-icon-tasks {
            background: linear-gradient(135deg, #fbbf24, #d97706);
        }

        .card-icon-progress {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .card-icon-resources {
            background: linear-gradient(135deg, #ec4899, #db2777);
        }

        .card-title {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
        }

        .card-subtitle {
            margin: 0;
            font-size: 0.875rem;
            color: var(--text);
            opacity: 0.8;
        }

        .card-body {
            padding: 1.5rem;
            color: var(--text);
        }

        .card-footer {
            padding: 1rem 1.5rem;
            background-color: rgba(0, 0, 0, 0.03);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
        }
        
        [data-theme="dark"] .card-footer {
            background-color: rgba(255, 255, 255, 0.03);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.875rem;
            margin-right: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
        }

        .btn-secondary:hover {
            background-color: rgba(var(--primary-rgb), 0.2);
        }

        .btn-text {
            background: none;
            color: var(--primary);
            padding: 0;
        }

        .btn-text:hover {
            text-decoration: underline;
        }

        .club-empty-state {
            text-align: center;
            padding: 4rem 2rem;
            margin-bottom: 2rem;
            background-color: var(--card);
            border-radius: 16px;
            box-shadow: var(--shadow);
        }

        .empty-icon {
            font-size: 5rem;
            color: var(--primary);
            margin-bottom: 2rem;
            opacity: 0.8;
        }

        .empty-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .tab-content {
            margin-top: 2rem;
            width: 100%;
        }

        .tab-pane {
            display: none;
            width: 100%;
            padding: 0.5rem;
            min-height: 300px; /* Ensure minimum height so it's visible */
            position: relative; /* Create a new stacking context */
            z-index: 1; /* Ensure it's above any potential overlapping elements */
        }

        .tab-pane.active {
            display: block !important; /* Use !important to override any other styles */
            z-index: 2; /* Higher than inactive tabs */
        }
        
        /* Make sure main content area is visible */
        .main-content {
            background-color: var(--bg);
            min-height: 100vh;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.2s ease;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal[style*="display: flex"],
        .modal.active-modal {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        /* Improve modal button styling */
        .modal-actions .btn-primary,
        .modal-actions .btn-secondary {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-width: 80px;
            justify-content: center;
        }
        
        .modal-actions .btn-primary {
            background-color: var(--primary);
            color: white;
            border: none;
        }
        
        .modal-actions .btn-secondary {
            background-color: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }
        
        /* Fix buttons in modals */
        .modal-actions button {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 0.5rem;
        }

        .modal-content {
            background-color: var(--card);
            border-radius: 12px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 550px;
            max-height: 85vh;
            overflow-y: auto;
            color: var(--text);
            animation: slideUp 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text);
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            height: 32px;
            width: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            padding: 0;
            margin: 0;
        }

        .close-btn:hover {
            opacity: 1;
            background-color: rgba(var(--primary-rgb), 0.1);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input, 
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            color: var(--text);
            background-color: var(--bg);
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .required {
            color: var(--primary);
            margin-left: 3px;
        }

        .role-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 500;
            background-color: rgba(var(--primary-rgb), 0.1);
            color: var(--primary);
        }

        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            display: flex;
            align-items: center;
            background-color: var(--card);
            border-left: 4px solid;
            border-radius: 6px;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s, fadeOut 0.3s 4.7s;
            position: relative;
            z-index: 9999; /* Ensure notifications are visible */
            color: var(--text); /* Make sure text is readable */
            margin-bottom: 10px; /* Add space between toasts */
        }

        .toast-success {
            border-left-color: var(--success);
        }

        .toast-error {
            border-left-color: var(--danger);
        }

        .toast-warning {
            border-left-color: var(--warning);
        }

        .toast-info {
            border-left-color: var(--info);
        }

        .toast-content {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-grow: 1;
            color: var(--text);
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--text);
            opacity: 0.5;
            cursor: pointer;
        }

        .toast-close:hover {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .info-box {
            display: flex;
            gap: 0.75rem;
            background-color: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .info-box i {
            color: #3b82f6;
            margin-top: 0.25rem;
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            color: var(--text);
            opacity: 0.7;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(var(--primary-rgb), 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .members-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .members-table th {
            text-align: left;
            padding: 1rem;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .members-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .join-code-display {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .code-box {
            background-color: var(--bg);
            padding: 0.75rem 1rem;
            border-radius: 6px;
            font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            font-size: 1.125rem;
            letter-spacing: 0.1em;
            flex-grow: 1;
            text-align: center;
            color: var(--primary);
            border: 1px solid var(--border);
        }

        .menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background-color: var(--card);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            box-shadow: var(--shadow);
            color: var(--text);
            font-size: 1.25rem;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: flex;
            }

            .sidebar.open {
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .empty-actions {
                flex-direction: column;
            }

            .welcome-title {
                font-size: 1.75rem;
            }

            .welcome-subtitle {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .join-code-display {
                flex-direction: column;
            }
        }
    </style>
</head>
<body data-theme="light" class="theme-applied">
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </button>

    <div class="dashboard-container" id="dashboardContainer">
        <!-- Debug element to show errors -->
        <div id="debug-output" style="display: none; position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; border-radius: 5px; z-index: 9999; max-width: 80%; max-height: 200px; overflow: auto;"></div>
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Leaders Dashboard</h2>
            </div>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" id="dashboard-tab" onclick="openTab('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="members-tab" onclick="openTab('members')">
                        <i class="fas fa-user-friends"></i> Members
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="tasks-tab" onclick="openTab('assignments')">
                        <i class="fas fa-tasks"></i> Tasks
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="projects-tab" onclick="openTab('projects')">
                        <i class="fas fa-code"></i> Projects
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="chat-tab" onclick="openTab('chat')">
                        <i class="fas fa-comments"></i> Chat
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="resources-tab" onclick="openTab('resources')">
                        <i class="fas fa-link"></i> Resources
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="schedule-tab" onclick="openTab('schedule')">
                        <i class="fas fa-calendar-alt"></i> Schedule
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="rewards-tab" onclick="openTab('rewards')">
                        <i class="fas fa-gift"></i> Rewards
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="settings-tab" onclick="openTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </li>
            </ul>

            <div class="user-info">
                <img src="{{ url_for('static', filename='images/logo-rounded.png') }}" alt="User Avatar" class="user-avatar">
                <div>
                    <p class="user-name">{{ current_user.username }}</p>
                    <p class="user-email">{{ current_user.email }}</p>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">

            {% if club %}
            <!-- Club Leader View -->
            <div id="dashboard" class="tab-pane active">
                <div class="dashboard-header">
                    <h1 class="welcome-title">Welcome to {{ club.name }}</h1>
                    <p class="welcome-subtitle">Manage your hack club and empower your members with coding skills</p>

                    <div class="club-actions" style="margin-top: 1rem;">
                        <button class="btn btn-primary" onclick="openEditClubModal()">
                            <i class="fas fa-edit"></i> Edit Club
                        </button>
                        <button class="btn btn-secondary" onclick="generateJoinCode()">
                            <i class="fas fa-key"></i> Join Code: <span id="join-code-display">{{ club.join_code }}</span>
                        </button>
                    </div>
                </div>

                <!-- Dashboard Grid -->
                <div class="dashboard-grid">
                <!-- Club Members Card -->
                <div class="card" onclick="openTab('members')">
                    <div class="card-header">
                        <div class="card-icon card-icon-members">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Club Members</h3>
                            <p class="card-subtitle">Manage Members</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>{{ club.members|length }} total members</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text" onclick="openTab('members')">
                            <i class="fas fa-plus"></i> Add & View Members
                        </button>
                    </div>
                </div>

                <!-- Club Meetings Card -->
                <div class="card" onclick="openTab('schedule')">
                    <div class="card-header">
                        <div class="card-icon card-icon-meetings">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Club Meetings</h3>
                            <p class="card-subtitle">Schedule Meetings</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>Planning your next club meeting</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text" onclick="openCreateMeetingModal()">
                            <i class="fas fa-plus"></i> Schedule Meeting
                        </button>
                    </div>
                </div>

                <!-- Club Budget Card -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon card-icon-finances">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Club Budget</h3>
                            <p class="card-subtitle">Manage Finances</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>Track your club expenses and funding</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text">
                            <i class="fas fa-eye"></i> View Budget
                        </button>
                    </div>
                </div>

                <!-- Club Tasks Card -->
                <div class="card" onclick="openTab('assignments')">
                    <div class="card-header">
                        <div class="card-icon card-icon-tasks">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Club Tasks</h3>
                            <p class="card-subtitle">Manage Tasks</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>Assign coding challenges to members</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text" onclick="openCreateAssignmentModal()">
                            <i class="fas fa-plus"></i> Create Task
                        </button>
                    </div>
                </div>

                <!-- Member Progress Card -->
                <div class="card" onclick="openTab('projects')">
                    <div class="card-header">
                        <div class="card-icon card-icon-progress">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Learning Pathways</h3>
                            <p class="card-subtitle">Member Progress</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>Track member coding project progress</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text" onclick="openTab('projects')">
                            <i class="fas fa-eye"></i> View Pathways
                        </button>
                    </div>
                </div>

                <!-- Hack Club Resources Card -->
                <div class="card" onclick="openTab('resources')">
                    <div class="card-header">
                        <div class="card-icon card-icon-resources">
                            <i class="fas fa-book"></i>
                        </div>
                        <div>
                            <h3 class="card-title">Leader Resources</h3>
                            <p class="card-subtitle">Hack Club Resources</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>Access Hack Club workshops and resources</p>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-text" onclick="openTab('resources')">
                            <i class="fas fa-external-link-alt"></i> Access Resources
                        </button>
                    </div>
                </div>
            </div>

            {% elif current_user.club_memberships|length > 0 %}
            <!-- Member View of Clubs -->
            <div id="dashboard" class="tab-pane active">
                <div class="dashboard-header">
                    <h1 class="welcome-title">My Clubs</h1>
                    <p class="welcome-subtitle">Select a club to view or manage</p>
                </div>

                <div class="dashboard-grid">
                {% for membership in current_user.club_memberships %}
                <div class="card" onclick="viewClub({{ membership.club.id }})">
                    <div class="card-header">
                        <div class="card-icon card-icon-members">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <h3 class="card-title">{{ membership.club.name }}</h3>
                            <span class="role-badge {% if membership.role == 'co-leader' %}role-badge-leader{% endif %}">
                                {{ membership.role|capitalize }}
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <p>{{ membership.club.description or 'No description available' }}</p>
                        <div class="club-meta">
                            <p><i class="fas fa-map-marker-alt"></i> {{ membership.club.location or 'No location' }}</p>
                            <p><i class="fas fa-user-friends"></i> {{ membership.club.members|length }} members</p>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary" onclick="viewClub({{ membership.club.id }})">
                            <i class="fas fa-sign-in-alt"></i> View Club
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- Empty State -->
            <div id="dashboard" class="tab-pane active">
                <div class="dashboard-header">
                    <h1 class="welcome-title">Club Dashboard</h1>
                    <p class="welcome-subtitle">Join or create a club to get started</p>
                </div>

                <div class="club-empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-users-slash"></i>
                    </div>
                    <h2>You haven't joined any clubs yet</h2>
                    <p>Join an existing club with a join code or create your own!</p>
                    <div class="empty-actions">
                        <button class="btn btn-primary" onclick="openCreateClubModal()">
                            <i class="fas fa-plus"></i> Create Club
                        </button>
                        <button class="btn btn-secondary" onclick="openJoinClubModal()">
                            <i class="fas fa-sign-in-alt"></i> Join Club
                        </button>
                    </div>
                </div>
            {% endif %}

            <!-- Tab Contents for Club Leader or Member View of a Specific Club -->
            {% if club %}
            <div class="tab-content">
                <!-- Stream Tab Content -->
                <div id="stream" class="tab-pane">
                    <div class="stream-container">
                        <div class="post-composer">
                            <div class="composer-header">
                                <h3><i class="fas fa-pen"></i> Create Announcement</h3>
                            </div>
                            <div class="composer-body">
                                <textarea id="post-content" placeholder="Share an announcement with your club..."></textarea>
                                <div class="composer-actions">
                                    <button onclick="createPost()" class="btn-primary"><i class="fas fa-paper-plane"></i> Post</button>
                                </div>
                            </div>
                        </div>

                        <div class="posts-list" id="posts-container">
                            <div class="post-card">
                                <div class="post-header">
                                    <img src="{{ url_for('static', filename='images/logo-rounded.png') }}" alt="Profile" class="avatar">
                                    <div class="post-info">
                                        <h3>Club Leader</h3>
                                        <span class="post-date">Just now</span>
                                    </div>
                                    <div class="post-actions">
                                        <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>
                                </div>
                                <div class="post-content">
                                    <p>Welcome to our club! This is a sample announcement. Real announcements will appear here once you create them.</p>
                                </div>
                                <div class="post-footer">
                                    <button class="post-action"><i class="far fa-heart"></i> Like</button>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assignments Tab Content -->
                <div id="assignments" class="tab-pane">
                    <div class="assignments-container">
                        <div class="assignments-header">
                            <h3>Club Assignments</h3>
                            <button class="btn-primary" onclick="openCreateAssignmentModal()">
                                <i class="fas fa-plus"></i> New Assignment
                            </button>
                        </div>

                        <div class="assignments-list" id="assignments-container">
                            <div class="assignment-card">
                                <div class="assignment-status">
                                    <span class="status-badge status-active">Active</span>
                                </div>
                                <div class="assignment-body">
                                    <h3>Sample Assignment</h3>
                                    <p>This is a sample assignment to demonstrate how assignments will look in your club dashboard.</p>
                                    <div class="assignment-meta">
                                        <span><i class="fas fa-calendar-alt"></i> Due: Next week</span>
                                        <span><i class="fas fa-users"></i> For: All members</span>
                                    </div>
                                </div>
                                <div class="assignment-actions">
                                    <button class="btn-primary"><i class="fas fa-eye"></i> View</button>
                                    <button class="btn-secondary"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn-danger"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Members Tab Content -->
                <div id="members" class="tab-pane" style="display: none;">
                    <div class="members-container">
                        <div class="members-header">
                            <h3>Club Members</h3>
                            <button class="btn-primary" onclick="openAddMemberModal()">
                                <i class="fas fa-user-plus"></i> Add Member
                            </button>
                        </div>

                        <div class="members-list">
                            <table class="members-table">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="membersTableBody">
                                    {% for membership in club.members %}
                                        <tr>
                                            <td>{{ membership.user.username }}</td>
                                            <td>{{ membership.user.email }}</td>
                                            <td>
                                                <span class="role-badge {% if membership.role == 'co-leader' %}role-badge-leader{% endif %}">
                                                    {{ membership.role|capitalize }}
                                                </span>
                                            </td>
                                            <td>{{ membership.joined_at.strftime('%Y-%m-%d') }}</td>
                                            <td>
                                                <div class="action-buttons">
                                                    <button class="btn-icon" onclick="openChangeRoleModal({{ membership.id }}, '{{ membership.user.username }}', '{{ membership.role }}')">
                                                        <i class="fas fa-user-tag"></i>
                                                    </button>
                                                    <button class="btn-icon delete-action" onclick="openRemoveMemberModal({{ membership.id }}, '{{ membership.user.username }}')">
                                                        <i class="fas fa-user-minus"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Chat Tab Content -->
                <div id="chat" class="tab-pane" style="display: none;">
                    <div class="chat-container">
                        <div class="chat-sidebar">
                            <div class="chat-channels">
                                <h3>Channels</h3>
                                <ul class="channels-list">
                                    <li class="active"><i class="fas fa-hashtag"></i> general</li>
                                    <li><i class="fas fa-hashtag"></i> announcements</li>
                                    <li><i class="fas fa-hashtag"></i> help</li>
                                </ul>
                                <button class="btn-secondary btn-sm" onclick="openCreateChannelModal()">
                                    <i class="fas fa-plus"></i> New Channel
                                </button>
                            </div>
                        </div>

                        <div class="chat-main">
                            <div class="chat-header">
                                <h3><i class="fas fa-hashtag"></i> general</h3>
                            </div>

                            <div class="chat-messages" id="chat-messages-container">
                                <div class="chat-message">
                                    <img src="{{ url_for('static', filename='images/logo-rounded.png') }}" alt="Profile" class="avatar">
                                    <div class="message-content">
                                        <div class="message-header">
                                            <span class="message-sender">Club Bot</span>
                                            <span class="message-time">Just now</span>
                                        </div>
                                        <p>Welcome to the club chat! This is where you and your members can communicate in real-time.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="chat-input">
                                <textarea placeholder="Message #general" id="chat-message-input"></textarea>
                                <button class="send-button" onclick="sendChatMessage()">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resources Tab Content -->
                <div id="resources" class="tab-pane" style="display: none;">
                    <div class="resources-container">
                        <div class="resources-header">
                            <h3>Quick Links & Resources</h3>
                            <button class="btn-primary" onclick="openAddResourceModal()">
                                <i class="fas fa-plus"></i> Add Resource
                            </button>
                        </div>

                        <div class="resources-grid" id="resources-container">
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-book"></i>
                                </div>
                                <div class="resource-content">
                                    <h3>Sample Resource</h3>
                                    <p>This is an example resource that shows how your links will appear.</p>
                                </div>
                                <div class="resource-actions">
                                    <a href="#" class="btn-primary btn-sm">Visit</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule Tab Content -->
                <div id="schedule" class="tab-pane" style="display: none;">
                    <div class="schedule-container">
                        <div class="schedule-header">
                            <h3>Club Meeting Schedule</h3>
                            <button class="btn-primary" onclick="openCreateMeetingModal()">
                                <i class="fas fa-plus"></i> New Meeting
                            </button>
                        </div>

                        <div class="calendar-view">
                            <div class="calendar-nav">
                                <button class="btn-icon" onclick="prevMonth()">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <h3 id="currentMonth">Loading...</h3>
                                <button class="btn-icon" onclick="nextMonth()">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>

                            <div class="calendar">
                                <div class="calendar-header">
                                    <div>Sun</div>
                                    <div>Mon</div>
                                    <div>Tue</div>
                                    <div>Wed</div>
                                    <div>Thu</div>
                                    <div>Fri</div>
                                    <div>Sat</div>
                                </div>
                                <div class="calendar-body" id="calendar-body">
                                    <!-- Calendar will be filled dynamically -->
                                    <div class="loading-state">
                                        <div class="loading-spinner"></div>
                                        <p>Loading calendar...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="meetings-list">
                            <h4>Upcoming Meetings</h4>
                            <div id="upcoming-meetings">
                                <!-- Meetings will be filled dynamically -->
                                <div class="loading-state">
                                    <div class="loading-spinner"></div>
                                    <p>Loading meetings...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Projects Tab Content -->
                <div id="projects" class="tab-pane" style="display: none;">
                    <div class="projects-container">
                        <div class="projects-header">
                            <h3>Club Member Projects</h3>
                            <div class="projects-actions">
                                <button class="btn-secondary btn-sm" onclick="toggleFeaturedOnly()"><i class="fas fa-star"></i> <span id="featured-toggle-text">Show Featured Only</span></button>
                                <div class="search-box">
                                    <input type="text" id="project-search" placeholder="Search projects..." onkeyup="filterProjects()">
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                        </div>

                        <div class="projects-grid" id="projects-container">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <p>Loading member projects...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rewards Tab Content -->
                <div id="rewards" class="tab-pane" style="display: none;">
                    <div class="rewards-container">
                        <div class="rewards-header">
                            <h3>Hack Club Workshops & YSWSs </h3>
                            <p>Complete projects and workshops to earn awesome rewards!</p>
                        </div>

                        <div class="rewards-grid">
                            <div class="reward-card">
                                <div class="reward-icon">
                                    <i class="fas fa-pizza-slice"></i>
                                </div>
                                <div class="reward-content">
                                    <h3>$5 for Pizza</h3>
                                    <p>Ship any project and get $5 for pizza to celebrate!</p>
                                    <div class="reward-meta">
                                        <span><i class="fas fa-users"></i> For all club members</span>
                                    </div>
                                </div>
                                <div class="reward-actions">
                                    <a href="https://airtable.com/appSUAc40CDu6bDAp/pagvu2xGhfsMC8AOL/form" target="_blank" class="btn-primary">
                                        Log Project
                                    </a>
                                </div>
                            </div>

                            <div class="reward-card">
                                <div class="reward-icon">
                                    <i class="fas fa-mug-hot"></i>
                                </div>
                                <div class="reward-content">
                                    <h3>Boba Workshop</h3>
                                    <p>Build a website and get boba drinks for your club meeting!</p>
                                    <div class="reward-meta">
                                        <span><i class="fas fa-users"></i> For club workshop</span>
                                    </div>
                                </div>
                                <div class="reward-actions">
                                    <a href="https://forms.hackclub.com/t/5r7VGppu9wus" target="_blank" class="btn-primary">
                                        Run Workshop
                                    </a>
                                </div>
                            </div>

                            <div class="reward-card">
                                <div class="reward-icon">
                                    <i class="fas fa-ice-cream"></i>
                                </div>
                                <div class="reward-content">
                                    <h3>Swirl Workshop</h3>
                                    <p>Make a website together and get ice cream for your club!</p>
                                    <div class="reward-meta">
                                        <span><i class="fas fa-users"></i> For club workshop</span>
                                    </div>
                                </div>
                                <div class="reward-actions">
                                    <a href="https://forms.hackclub.com/t/8JgE9XsQanus" target="_blank" class="btn-primary">
                                        Run Workshop
                                    </a>
                                </div>
                            </div>
                        </div>

                        <div class="rewards-guide">
                            <h4>How to claim rewards:</h4>
                            <ol>
                                <li>Complete the required project or workshop with your club</li>
                                <li>Click the corresponding "Claim Reward" or "Run Workshop" button</li>
                                <li>Fill out the form with your project details</li>
                                <li>Wait for Hack Club to process your request</li>
                            </ol>
                            <div class="info-box">
                                <i class="fas fa-info-circle"></i>
                                <p>All rewards are provided by Hack Club and subject to their terms and availability.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab Content -->
                <div id="settings" class="tab-pane" style="display: none;">
                    <div class="settings-container">
                        <h3>Club Settings</h3>

                        <div class="settings-card">
                            <div class="settings-section">
                                <h4>General Information</h4>
                                <form id="editClubForm">
                                    <div class="form-group">
                                        <label for="editClubName">Club Name</label>
                                        <input type="text" id="editClubName" name="editClubName" value="{{ club.name }}" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="editClubLocation">Location</label>
                                        <input type="text" id="editClubLocation" name="editClubLocation" value="{{ club.location }}" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="editClubDescription">Description</label>
                                        <textarea id="editClubDescription" name="editClubDescription" rows="4" class="form-textarea">{{ club.description }}</textarea>
                                    </div>
                                    <button type="button" onclick="updateClub()" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Changes
                                    </button>
                                </form>
                            </div>

                            <div class="settings-section danger-zone">
                                <h4>Danger Zone</h4>
                                <p>Deleting a club is permanent and will remove all members, posts, and assignments.</p>
                                <button class="btn btn-danger" onclick="openDeleteClubModal()">
                                    <i class="fas fa-trash"></i> Delete Club
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </main>
    </div>

    <!-- Create Club Modal -->
    <div id="createClubModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> Create New Club</h2>
                <button class="close-btn" onclick="closeCreateClubModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createClubForm">
                    <div class="form-group">
                        <label for="clubName">Club Name <span class="required">*</span></label>
                        <input type="text" id="clubName" name="clubName" required placeholder="E.g., Hack Club Central High" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="clubLocation">Location</label>
                        <input type="text" id="clubLocation" name="clubLocation" placeholder="E.g., Room 203, Central High School" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="clubDescription">Description</label>
                        <textarea id="clubDescription" name="clubDescription" rows="4" placeholder="Tell us about your club..." class="form-textarea"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCreateClubModal()">Cancel</button>
                <button class="btn-primary" onclick="createClub()">
                    <i class="fas fa-plus"></i> Create Club
                </button>
            </div>
        </div>
    </div>

    <!-- Join Club Modal -->
    <div id="joinClubModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Join a Club</h2>
                <button class="close-btn" onclick="closeJoinClubModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="joinCode">Club Join Code <span class="required">*</span></label>
                    <input type="text" id="joinCode" name="joinCode" required placeholder="Enter the join code provided by your club leader" class="form-input">
                </div>
                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <p>By joining a club, you grant club leaders access to view and manage your spaces.</p>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeJoinClubModal()">Cancel</button>
                <button class="btn-primary" onclick="joinClub()">
                    <i class="fas fa-sign-in-alt"></i> Join Club
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Club Modal -->
    <div id="editClubModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Edit Club</h2>
                <button class="close-btn" onclick="closeEditClubModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editModalForm">
                    <div class="form-group">
                        <label for="editModalClubName">Club Name <span class="required">*</span></label>
                        <input type="text" id="editModalClubName" name="editModalClubName" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editModalClubLocation">Location</label>
                        <input type="text" id="editModalClubLocation" name="editModalClubLocation" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="editModalClubDescription">Description</label>
                        <textarea id="editModalClubDescription" name="editModalClubDescription" rows="4" class="form-textarea"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeEditClubModal()">Cancel</button>
                <button class="btn-primary" onclick="updateClubFromModal()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Add Member</h2>
                <button class="close-btn" onclick="closeAddMemberModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="join-code-info">
                    <div class="info-card">
                        <h3><i class="fas fa-key"></i> Join Code</h3>
                        <p>Share your club's join code with members and let them join on their own.</p>
                        <div class="join-code-display">
                            {% if club.join_code %}
                                <div class="code-box">{{ club.join_code }}</div>
                                <button class="btn-primary" onclick="copyJoinCode()">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            {% else %}
                                <button class="btn-primary" onclick="generateJoinCode()">
                                    <i class="fas fa-key"></i> Generate Join Code
                                </button>
                            {% endif %}
                        </div>
                        <p><small>Members can join by entering this code on their dashboard.</small></p>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeAddMemberModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Change Role Modal -->
    <div id="changeRoleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-tag"></i> Change Member Role</h2>
                <button class="close-btn" onclick="closeChangeRoleModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Change role for <span id="roleUsername" class="highlighted-text"></span>:</p>
                <input type="hidden" id="membershipIdForRole">
                <div class="role-selector">
                    <label class="role-option">
                        <input type="radio" name="memberRole" value="member" id="roleMember">
                        <span class="role-card">
                            <i class="fas fa-user"></i>
                            <span>Member</span>
                            <span class="role-description">Regular club member with basic privileges</span>
                        </span>
                    </label>
                    <label class="role-option">
                        <input type="radio" name="memberRole" value="co-leader" id="roleLeader">
                        <span class="role-card">
                            <i class="fas fa-crown"></i>
                            <span>Co-Leader</span>
                            <span class="role-description">Can manage members and club settings</span>
                        </span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeChangeRoleModal()">Cancel</button>
                <button class="btn-primary" onclick="changeRole()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Create Assignment Modal -->
    <div id="createAssignmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-tasks"></i> Create Assignment</h2>
                <button class="close-btn" onclick="closeCreateAssignmentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createAssignmentForm">
                    <div class="form-group">
                        <label for="assignmentTitle">Title <span class="required">*</span></label>
                        <input type="text" id="assignmentTitle" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="assignmentDescription">Description <span class="required">*</span></label>
                        <textarea id="assignmentDescription" rows="4" required class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="assignmentDueDate">Due Date</label>
                        <input type="date" id="assignmentDueDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Assignment For:</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="assignAllMembers" checked> All Members
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCreateAssignmentModal()">Cancel</button>
                <button class="btn-primary" onclick="createAssignment()">
                    <i class="fas fa-plus"></i> Create Assignment
                </button>
            </div>
        </div>
    </div>

    <!-- Add Resource Modal -->
    <div id="addResourceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-link"></i> Add Resource</h2>
                <button class="close-btn" onclick="closeAddResourceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addResourceForm">
                    <div class="form-group">
                        <label for="resourceTitle">Title <span class="required">*</span></label>
                        <input type="text" id="resourceTitle" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="resourceUrl">URL <span class="required">*</span></label>
                        <input type="url" id="resourceUrl" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="resourceDescription">Description</label>
                        <textarea id="resourceDescription" rows="3" class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="resourceIcon">Icon</label>
                        <select id="resourceIcon" class="form-input">
                            <option value="book">Book</option>
                            <option value="link">Link</option>
                            <option value="file">File</option>
                            <option value="video">Video</option>
                            <option value="code">Code</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeAddResourceModal()">Cancel</button>
                <button class="btn-primary" onclick="addResource()">
                    <i class="fas fa-plus"></i> Add Resource
                </button>
            </div>
        </div>
    </div>

    <!-- Create Channel Modal -->
    <div id="createChannelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-hashtag"></i> Create Channel</h2>
                <button class="close-btn" onclick="closeCreateChannelModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createChannelForm">
                    <div class="form-group">
                        <label for="channelName">Channel Name <span class="required">*</span></label>
                        <input type="text" id="channelName" required placeholder="e.g. homework-help" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="channelDescription">Description</label>
                        <textarea id="channelDescription" placeholder="What's this channel about?" rows="3" class="form-textarea"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCreateChannelModal()">Cancel</button>
                <button class="btn-primary" onclick="createChannel()">
                    <i class="fas fa-plus"></i> Create Channel
                </button>
            </div>
        </div>
    </div>

    <!-- Create Meeting Modal -->
    <div id="createMeetingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-plus"></i> Schedule Meeting</h2>
                <button class="close-btn" onclick="closeCreateMeetingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createMeetingForm">
                    <div class="form-group">
                        <label for="meetingTitle">Meeting Title <span class="required">*</span></label>
                        <input type="text" id="meetingTitle" required placeholder="e.g. Weekly Check-in" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="meetingDescription">Description</label>
                        <textarea id="meetingDescription" placeholder="What's this meeting about?" rows="3" class="form-textarea"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="meetingDate">Date <span class="required">*</span></label>
                        <input type="date" id="meetingDate" required class="form-input">
                    </div>
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="startTime">Start Time <span class="required">*</span></label>
                            <input type="time" id="startTime" required class="form-input">
                        </div>
                        <div class="form-group half">
                            <label for="endTime">End Time</label>
                            <input type="time" id="endTime" class="form-input">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="meetingLocation">Location</label>
                        <input type="text" id="meetingLocation" placeholder="e.g. Room 203 or Virtual" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="meetingLink">Meeting Link</label>
                        <input type="url" id="meetingLink" placeholder="e.g. Zoom or Google Meet URL" class="form-input">
                    </div>
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeCreateMeetingModal()">Cancel</button>
                <button class="btn-primary" onclick="createMeeting()">
                    <i class="fas fa-plus"></i> Schedule Meeting
                </button>
            </div>
        </div>
    </div>

    <!-- View Meeting Modal -->
    <div id="viewMeetingModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-calendar-day"></i> <span id="viewMeetingTitle">Meeting Details</span></h2>
                <button class="close-btn" onclick="closeViewMeetingModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="meeting-details">
                    <div class="meeting-meta">
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span id="viewMeetingTime"></span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="viewMeetingLocation">No location specified</span>
                        </div>
                        <div class="meta-item" id="viewMeetingLinkContainer">
                            <i class="fas fa-link"></i>
                            <a href="#" id="viewMeetingLink" target="_blank">Join Meeting</a>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-user"></i>
                            <span id="viewMeetingCreator"></span>
                        </div>
                    </div>

                    <div class="meeting-description-section">
                        <h4>Description</h4>
                        <p id="viewMeetingDescription">No description provided.</p>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <input type="hidden" id="currentMeetingId">
                <button class="btn-secondary" onclick="closeViewMeetingModal()">Close</button>
                <button class="btn-primary" onclick="editMeeting()">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn-danger" onclick="confirmDeleteMeeting()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Toast container for notifications -->
    <div id="toast-container"></div>

    <script>
// Theme toggle functionality
document.addEventListener('DOMContentLoaded', function() {
    // Initialize active tab on page load
    setTimeout(function() {
        // Get the hash from URL or default to dashboard
        let hash = window.location.hash.substring(1) || 'dashboard';
        
        // Make sure the tab content exists
        if (!document.getElementById(hash)) {
            console.warn('Tab not found, defaulting to dashboard:', hash);
            hash = 'dashboard';
        }
        
        // Pre-show the active tab
        const activeTab = document.getElementById(hash);
        if (activeTab) {
            activeTab.style.display = 'block';
            activeTab.style.opacity = '1';
            activeTab.style.visibility = 'visible';
            activeTab.classList.add('active');
        }
        
        // Then call openTab to properly setup the UI
        openTab(hash);
    }, 50);
    
    // Also listen for hash changes
    window.addEventListener('hashchange', function() {
        const hash = window.location.hash.substring(1);
        if (hash) {
            openTab(hash);
        }
    });
    
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const body = document.documentElement;

    // Force apply the theme to body as well for broader compatibility
    function applyTheme(theme) {
        body.setAttribute('data-theme', theme);
        document.body.setAttribute('data-theme', theme); // Also set on body
        updateThemeIcon(theme);
        
        // Force refresh CSS variables on some elements
        const elementsToRefresh = document.querySelectorAll('.modal-content, .card, .form-input, .form-textarea, .btn, .nav-link');
        elementsToRefresh.forEach(el => {
            el.style.color = 'var(--text)';
            if (el.classList.contains('card') || el.classList.contains('modal-content')) {
                el.style.backgroundColor = 'var(--card)';
            }
        });
        
        console.log('Theme applied:', theme);
    }

    // Check for saved theme preference or respect OS preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
        applyTheme(savedTheme);
    } else {
        // Check if user prefers dark mode
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) {
            applyTheme('dark');
        } else {
            applyTheme('light');
        }
    }

    function updateThemeIcon(theme) {
        if (theme === 'dark') {
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
        } else {
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        }
    }

    themeToggle.addEventListener('click', function() {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
    });
    
    // Initial tab setup
    // Clear all style attributes that might be interfering with display
    document.querySelectorAll('.tab-pane').forEach(pane => {
        if (pane.classList.contains('active')) {
            pane.style.display = 'block';
            pane.style.opacity = '1';
            pane.style.visibility = 'visible';
            console.log('Initial tab set visible:', pane.id);
        }
    });
});

// Tab functionality
function openTab(tabName) {
    console.log('Opening tab:', tabName);
    
    // Update URL hash without scrolling
    const scrollPos = window.scrollY;
    window.location.hash = tabName;
    window.scrollTo(0, scrollPos);
    
    // First, check if the tab exists to prevent issues
    const selectedTab = document.getElementById(tabName);
    if (!selectedTab) {
        console.error('Tab not found:', tabName);
        // Fallback to dashboard if tab doesn't exist
        if (tabName !== 'dashboard') {
            return openTab('dashboard');
        }
        return;
    }
    
    // Hide all tab panes first
    const tabPanes = document.querySelectorAll('.tab-pane');
    tabPanes.forEach(function(pane) {
        pane.classList.remove('active');
        pane.style.display = 'none';
    });

    // Deactivate all tab links
    const tabLinks = document.querySelectorAll('.nav-link');
    tabLinks.forEach(function(link) {
        link.classList.remove('active');
    });

    // Activate selected tab immediately
    selectedTab.classList.add('active');
    selectedTab.style.display = 'block';
    
    // Activate the correct nav link
    const selectedLink = document.getElementById(tabName + '-tab');
    if (selectedLink) {
        selectedLink.classList.add('active');
    } else if (tabName === 'dashboard') {
        // Special case for dashboard
        document.getElementById('dashboard-tab').classList.add('active');
    }

    // Load data for active tab with proper error handling
    try {
        if (tabName === 'stream') {
            typeof loadPosts === 'function' && loadPosts();
        } else if (tabName === 'assignments') {
            typeof loadAssignments === 'function' && loadAssignments();
        } else if (tabName === 'resources') {
            typeof loadResources === 'function' && loadResources();
        } else if (tabName === 'chat') {
            typeof loadChatChannels === 'function' && loadChatChannels();
        } else if (tabName === 'schedule') {
            typeof loadMeetings === 'function' && loadMeetings();
        } else if (tabName === 'projects') {
            typeof loadProjects === 'function' && loadProjects();
        }
    } catch (error) {
        console.error('Error loading tab data:', error);
        showToast('error', 'Failed to load tab content');
    }
}

// Mobile sidebar toggle
const menuToggle = document.getElementById('menuToggle');
const sidebar = document.getElementById('sidebar');

menuToggle.addEventListener('click', toggleSidebar);

function toggleSidebar() {
    sidebar.classList.toggle('open');
    document.body.classList.toggle('sidebar-open');
}

// Close sidebar when clicking a link on mobile
const navLinks = document.querySelectorAll('.nav-link');
navLinks.forEach(function(link) {
    link.addEventListener('click', function() {
        if (window.innerWidth < 1024) {
            toggleSidebar();
        }
    });
});

// Handle responsiveness
window.addEventListener('resize', function() {
    if (window.innerWidth >= 1024) {
        sidebar.classList.remove('open');
        document.body.classList.remove('sidebar-open');
    }
});

// Modal Functions
function openModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;

    modal.style.display = 'flex';
    modal.style.opacity = '1';
    modal.style.visibility = 'visible';
    document.body.style.overflow = 'hidden';
    
    // Ensure modal is visible and properly styled
    modal.classList.add('active-modal');
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (!modal) return;

    modal.style.opacity = '0';
    modal.style.visibility = 'hidden';
    modal.classList.remove('active-modal');
    setTimeout(() => {
        modal.style.display = 'none';
        document.body.style.overflow = '';
    }, 300);
}

// Create Club Modal
function openCreateClubModal() {
    openModal('createClubModal');
}

function closeCreateClubModal() {
    closeModal('createClubModal');
    document.getElementById('createClubForm').reset();
}

// Join Club Modal
function openJoinClubModal() {
    openModal('joinClubModal');
}

function closeJoinClubModal() {
    closeModal('joinClubModal');
    document.getElementById('joinCode').value = '';
}

// Edit Club Modal
function openEditClubModal() {
    // Fetch current club data
    fetch('/api/clubs/current')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showToast('error', data.error);
                return;
            }

            document.getElementById('editModalClubName').value = data.name || '';
            document.getElementById('editModalClubLocation').value = data.location || '';
            document.getElementById('editModalClubDescription').value = data.description || '';

            openModal('editClubModal');
        })
        .catch(error => {
            showToast('error', 'Failed to fetch club details');
            console.error('Error:', error);
        });
}

function closeEditClubModal() {
    closeModal('editClubModal');
}

// Add Member Modal
function openAddMemberModal() {
    openModal('addMemberModal');
}

function closeAddMemberModal() {
    closeModal('addMemberModal');
}

// Change Role Modal
function openChangeRoleModal(membershipId, username, currentRole) {
    document.getElementById('membershipIdForRole').value = membershipId;
    document.getElementById('roleUsername').textContent = username;

    // Set the current role
    if (currentRole === 'member') {
        document.getElementById('roleMember').checked = true;
    } else if (currentRole === 'co-leader') {
        document.getElementById('roleLeader').checked = true;
    }

    openModal('changeRoleModal');
}

function closeChangeRoleModal() {
    closeModal('changeRoleModal');
}

// Create Assignment Modal
function openCreateAssignmentModal() {
    openModal('createAssignmentModal');
}

function closeCreateAssignmentModal() {
    closeModal('createAssignmentModal');
    document.getElementById('createAssignmentForm').reset();
}

// Add Resource Modal
function openAddResourceModal() {
    openModal('addResourceModal');
}

function closeAddResourceModal() {
    closeModal('addResourceModal');
    document.getElementById('addResourceForm').reset();
}

// Create Channel Modal
function openCreateChannelModal() {
    openModal('createChannelModal');
}

function closeCreateChannelModal() {
    closeModal('createChannelModal');
    document.getElementById('createChannelForm').reset();
}

// Create Meeting Modal
function openCreateMeetingModal() {
    // Set today's date as default
    const today = new Date();
    const dateString = today.toISOString().split('T')[0];
    document.getElementById('meetingDate').value = dateString;

    // Set default start and end times (1 hour apart)
    const currentHour = today.getHours();
    const startTime = `${String(currentHour).padStart(2, '0')}:00`;
    const endTime = `${String(currentHour + 1).padStart(2, '0')}:00`;

    document.getElementById('startTime').value = startTime;
    document.getElementById('endTime').value = endTime;

    // Reset form
    document.getElementById('meetingTitle').value = '';
    document.getElementById('meetingDescription').value = '';
    document.getElementById('meetingLocation').value = '';
    document.getElementById('meetingLink').value = '';

    // Update save button behavior
    const saveBtn = document.querySelector('#createMeetingModal .modal-actions .btn-primary');
    saveBtn.innerHTML = '<i class="fas fa-plus"></i> Schedule Meeting';
    saveBtn.onclick = createMeeting;

    openModal('createMeetingModal');
}

function closeCreateMeetingModal() {
    closeModal('createMeetingModal');
}

function closeViewMeetingModal() {
    closeModal('viewMeetingModal');
}

// Copy join code to clipboard
function copyJoinCode() {
    const joinCodeDisplay = document.getElementById('join-code-display');
    if (joinCodeDisplay) {
        const joinCode = joinCodeDisplay.textContent;
        navigator.clipboard.writeText(joinCode).then(() => {
            showToast('success', 'Join code copied to clipboard');
        }).catch(err => {
            showToast('error', 'Failed to copy join code');
            console.error('Could not copy text: ', err);
        });
    }
}

// Generate new join code
function generateJoinCode() {
    fetch('/api/clubs/join-code/generate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            if (data.join_code) {
                const joinCodeDisplay = document.getElementById('join-code-display');
                if (joinCodeDisplay) {
                    joinCodeDisplay.textContent = data.join_code;
                }
            } else {
                setTimeout(() => {
                    location.reload();
                }, 1500);
            }
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to generate join code');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to generate join code');
        console.error('Error:', error);
    });
}

// Create club functionality
function createClub() {
    const formData = {
        name: document.getElementById('clubName').value.trim(),
        location: document.getElementById('clubLocation').value.trim(),
        description: document.getElementById('clubDescription').value.trim()
    };

    if (!formData.name) {
        showToast('error', 'Club name is required');
        return;
    }

    fetch('/api/clubs', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            closeCreateClubModal();
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to create club');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to create club');
        console.error('Error:', error);
    });
}

// Join club functionality
function joinClub() {
    const joinCode = document.getElementById('joinCode').value.trim();

    if (!joinCode) {
        showToast('error', 'Join code is required');
        return;
    }

    fetch('/api/clubs/join', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ join_code: joinCode })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            closeJoinClubModal();
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to join club');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to join club');
        console.error('Error:', error);
    });
}

// Update club functionality
function updateClub() {
    const formData = {
        name: document.getElementById('editClubName').value.trim(),
        location: document.getElementById('editClubLocation').value.trim(),
        description: document.getElementById('editClubDescription').value.trim()
    };

    if (!formData.name) {
        showToast('error', 'Club name is required');
        return;
    }

    fetch('/api/clubs/current', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to update club');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to update club');
        console.error('Error:', error);
    });
}

// Update club from modal
function updateClubFromModal() {
    const formData = {
        name: document.getElementById('editModalClubName').value.trim(),
        location: document.getElementById('editModalClubLocation').value.trim(),
        description: document.getElementById('editModalClubDescription').value.trim()
    };

    if (!formData.name) {
        showToast('error', 'Club name is required');
        return;
    }

    fetch('/api/clubs/current', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            closeEditClubModal();
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to update club');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to update club');
        console.error('Error:', error);
    });
}

// Change member role
function changeRole() {
    const membershipId = document.getElementById('membershipIdForRole').value;
    const selectedRole = document.querySelector('input[name="memberRole"]:checked').value;

    fetch(`/api/clubs/members/${membershipId}/role`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ role: selectedRole })
    })
    .then(response => response.json())
    .then(data => {
        if (data.message) {
            showToast('success', data.message);
            closeChangeRoleModal();
            setTimeout(() => {
                location.reload();
            }, 1500);
        } else if (data.error) {
            showToast('error', data.error);
        } else {
            showToast('error', 'Failed to update member role');
        }
    })
    .catch(error => {
        showToast('error', 'Failed to update member role');
        console.error('Error:', error);
    });
}

// Get club ID from the page
function getClubId() {
    // Try to get from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const clubId = urlParams.get('club_id');

    // Return what we found
    return clubId;
}

// Display toast notifications
function showToast(type, message) {
    // Also log to debug output
    const debugOutput = document.getElementById('debug-output');
    if (debugOutput) {
        debugOutput.style.display = 'block';
        const timestamp = new Date().toLocaleTimeString();
        debugOutput.innerHTML += `<div>[${timestamp}] ${type}: ${message}</div>`;
        setTimeout(() => {
            debugOutput.style.display = 'none';
        }, 5000);
    }
    const toastContainer = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.classList.add('toast', `toast-${type}`);

    let icon = '';
    switch (type) {
        case 'success':
            icon = '<i class="fas fa-check-circle"></i>';
            break;
        case 'error':
            icon = '<i class="fas fa-exclamation-circle"></i>';
            break;
        case 'warning':
            icon = '<i class="fas fa-exclamation-triangle"></i>';
            break;
        case 'info':
            icon = '<i class="fas fa-info-circle"></i>';
            break;
    }

    toast.innerHTML = `
        <div class="toast-content">
            ${icon}
            <span>${message}</span>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
    `;

    toastContainer.appendChild(toast);

    // Auto-remove the toast after 5 seconds
    setTimeout(() => {
        toast.classList.add('toast-fade-out');
        setTimeout(() => {
            toast.remove();
        }, 300);
    }, 5000);
}

// View a specific club for members with multiple clubs
function viewClub(clubId) {
    window.location.href = `/club-dashboard?club_id=${clubId}`;
}

// Fetch and display posts
function loadPosts() {
    const clubId = getClubId();
    if (!clubId) {
        console.error('Could not determine club ID');
        return;
    }

    const postsContainer = document.getElementById('posts-container');
    if (!postsContainer) return;

    postsContainer.innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading posts...</p>
        </div>
    `;

    fetch(`/api/clubs/${clubId}/posts`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showToast('error', data.error);
                return;
            }

            if (data.posts && data.posts.length === 0) {
                postsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comment-slash"></i>
                        <p>No posts yet. Be the first to post!</p>
                    </div>
                `;
                return;
            }

            postsContainer.innerHTML = '';

            data.posts.forEach(post => {
                const postCard = document.createElement('div');
                postCard.classList.add('post-card');
                postCard.setAttribute('data-post-id', post.id);

                const postDate = new Date(post.created_at);
                const formattedDate = postDate.toLocaleString();

                postCard.innerHTML = `
                    <div class="post-header">
                        <img src="/static/images/logo-rounded.png" alt="Profile" class="avatar">
                        <div class="post-info">
                            <h3>${post.user.username}</h3>
                            <span class="post-date">${formattedDate}</span>
                        </div>
                        <div class="post-actions">
                            <button class="btn-icon post-menu-btn" onclick="togglePostMenu(${post.id})">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>${post.content}</p>
                    </div>
                    <div class="post-footer">
                        <button class="post-action" onclick="toggleLike(${post.id})">
                            <i class="far fa-heart"></i> Like
                        </button>
                    </div>
                `;

                postsContainer.appendChild(postCard);
            });
        })
        .catch(error => {
            console.error('Error loading posts:', error);
            postsContainer.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Failed to load posts. Please try again.</p>
                </div>
            `;
        });
}

// Create a new post
function createPost() {
    const content = document.getElementById('post-content').value.trim();
    const clubId = getClubId();

    if (!content) {
        showToast('error', 'Post content cannot be empty');
        return;
    }

    fetch(`/api/clubs/${clubId}/posts`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showToast('error', data.error);
            return;
        }

        showToast('success', 'Post created successfully');
        document.getElementById('post-content').value = '';

        // Reload posts
        loadPosts();
    })
    .catch(error => {
        console.error('Error creating post:', error);
        showToast('error', 'Failed to create post');
    });
}

// Load assignments
function loadAssignments() {
    const clubId = getClubId();
    if (!clubId) {
        console.error('Could not determine club ID');
        return;
    }

    const assignmentsContainer = document.getElementById('assignments-container');
    if (!assignmentsContainer) return;

    assignmentsContainer.innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading assignments...</p>
        </div>
    `;

    fetch(`/api/clubs/${clubId}/assignments`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showToast('error', data.error);
                return;
            }

            if (!data.assignments || data.assignments.length === 0) {
                assignmentsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-tasks"></i>
                        <p>No assignments yet. Create one to get started.</p>
                    </div>
                `;
                return;
            }

            assignmentsContainer.innerHTML = '';

            data.assignments.forEach(assignment => {
                const assignmentCard = document.createElement('div');
                assignmentCard.classList.add('assignment-card');
                assignmentCard.setAttribute('data-assignment-id', assignment.id);

                let dueDate = 'No due date';
                if (assignment.due_date) {
                    const date = new Date(assignment.due_date);
                    dueDate = date.toLocaleDateString();
                }

                assignmentCard.innerHTML = `
                    <div class="assignment-status">
                        <span class="status-badge status-active">Active</span>
                    </div>
                    <div class="assignment-body">
                        <h3>${assignment.title}</h3>
                        <p>${assignment.description}</p>
                        <div class="assignment-meta">
                            <span><i class="fas fa-calendar-alt"></i> Due: ${dueDate}</span>
                            <span><i class="fas fa-user"></i> By: ${assignment.creator?.username || 'Unknown'}</span>
                        </div>
                    </div>
                    <div class="assignment-actions">
                        <button class="btn-primary" onclick="viewAssignment(${assignment.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-secondary" onclick="editAssignment(${assignment.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn-danger" onclick="deleteAssignment(${assignment.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;

                assignmentsContainer.appendChild(assignmentCard);
            });
        })
        .catch(error => {
            console.error('Error loading assignments:', error);
            assignmentsContainer.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Failed to load assignments. Please try again.</p>
                </div>
            `;
        });
}

// Create a new assignment
function createAssignment() {
    const clubId = getClubId();
    const title = document.getElementById('assignmentTitle').value.trim();
    const description = document.getElementById('assignmentDescription').value.trim();
    const dueDate = document.getElementById('assignmentDueDate').value;

    if (!title || !description) {
        showToast('error', 'Title and description are required');
        return;
    }

    const data = {
        title,
        description,
        due_date: dueDate || null
    };

    fetch(`/api/clubs/${clubId}/assignments`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showToast('error', data.error);
            return;
        }

        showToast('success', 'Assignment created successfully');
        closeCreateAssignmentModal();

        // Clear form
        document.getElementById('createAssignmentForm').reset();

        // Reload assignments
        loadAssignments();
    })
    .catch(error => {
        console.error('Error creating assignment:', error);
        showToast('error', 'Failed to create assignment');
    });
}

// Load resources
function loadResources() {
    const clubId = getClubId();
    if (!clubId) {
        console.error('Could not determine club ID');
        return;
    }

    const resourcesContainer = document.getElementById('resources-container');
    if (!resourcesContainer) return;

    resourcesContainer.innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading resources...</p>
        </div>
    `;

    fetch(`/api/clubs/${clubId}/resources`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                showToast('error', data.error);
                return;
            }

            if (!data.resources || data.resources.length === 0) {
                resourcesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-link"></i>
                        <p>No resources yet. Add some links to get started.</p>
                    </div>
                `;
                return;
            }

            resourcesContainer.innerHTML = '';

            data.resources.forEach(resource => {
                const resourceCard = document.createElement('div');
                resourceCard.classList.add('resource-card');
                resourceCard.setAttribute('data-resource-id', resource.id);

                resourceCard.innerHTML = `
                    <div class="resource-icon">
                        <i class="fas fa-${resource.icon || 'link'}"></i>
                    </div>
                    <div class="resource-content">
                        <h3>${resource.title}</h3>
                        <p>${resource.description || 'No description provided'}</p>
                    </div>
                    <div class="resource-actions">
                        <a href="${resource.url}" target="_blank" class="btn-primary btn-sm">Visit</a>
                    </div>
                `;

                resourcesContainer.appendChild(resourceCard);
            });
        })
        .catch(error => {
            console.error('Error loading resources:', error);
            resourcesContainer.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <p>Failed to load resources. Please try again.</p>
                </div>
            `;
        });
}

// Add a new resource
function addResource() {
    const clubId = getClubId();
    const title = document.getElementById('resourceTitle').value.trim();
    const url = document.getElementById('resourceUrl').value.trim();
    const description = document.getElementById('resourceDescription').value.trim();
    const icon = document.getElementById('resourceIcon').value;

    if (!title || !url) {
        showToast('error', 'Title and URL are required');
        return;
    }

    const data = {
        title,
        url,
        description,
        icon
    };

    fetch(`/api/clubs/${clubId}/resources`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showToast('error', data.error);
            return;
        }

        showToast('success', 'Resource added successfully');
        closeAddResourceModal();

        // Clear form
        document.getElementById('addResourceForm').reset();

        // Reload resources
        loadResources();
    })
    .catch(error => {
        console.error('Error adding resource:', error);
        showToast('error', 'Failed to add resource');
    });
}

// Load chat channels
function loadChatChannels() {
    const clubId = getClubId();
    if (!clubId) {
        console.error('Could not determine club ID');
        return;
    }

    const channelsList = document.querySelector('.channels-list');
    if (!channelsList) return;

    channelsList.innerHTML = `
        <li><div class="loading-spinner-small"></div> Loading...</li>
    `;

    // Load channels logic would go here
    // Since chat is a complex feature, we're just showing a placeholder for demonstration
    channelsList.innerHTML = `
        <li class="active"><i class="fas fa-hashtag"></i> general</li>
        <li><i class="fas fa-hashtag"></i> announcements</li>
        <li><i class="fas fa-hashtag"></i> help</li>
    `;
}

// Create a new channel
function createChannel() {
    const clubId = getClubId();
    const channelName = document.getElementById('channelName').value.trim().toLowerCase();
    const channelDescription = document.getElementById('channelDescription').value.trim();

    if (!channelName) {
        showToast('error', 'Channel name is required');
        return;
    }

    // Validate channel name (only lowercase letters, numbers, and hyphens)
    if (!/^[a-z0-9\-]+$/.test(channelName)) {
        showToast('error', 'Channel name can only contain lowercase letters, numbers, and hyphens');
        return;
    }

    const data = {
        name: channelName,
        description: channelDescription
    };

    fetch(`/api/clubs/${clubId}/channels`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            showToast('error', data.error);
            return;
        }

        showToast('success', 'Channel created successfully');
        closeCreateChannelModal();

        // Clear form
        document.getElementById('createChannelForm').reset();

        // Reload channels
        loadChatChannels();
    })
    .catch(error => {
        console.error('Error creating channel:', error);
        showToast('error', 'Failed to create channel');
    });
}

// Send a chat message
function sendChatMessage() {
    const messageInput = document.getElementById('chat-message-input');
    const message = messageInput.value.trim();

    if (!message) {
        return;
    }

    // Add message to chat (simple immediate feedback)
    const messagesContainer = document.getElementById('chat-messages-container');

    const messageElement = document.createElement('div');
    messageElement.classList.add('chat-message');

    const messageDate = new Date();
    const formattedDate = messageDate.toLocaleString();

    messageElement.innerHTML = `
        <img src="/static/images/logo-rounded.png" alt="Profile" class="avatar">
        <div class="message-content">
            <div class="message-header">
                <span class="message-sender">You</span>
                <span class="message-time">${formattedDate}</span>
            </div>
            <p>${message}</p>
        </div>
    `;

    messagesContainer.appendChild(messageElement);

    // Clear input
    messageInput.value = '';

    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;

    showToast('info', 'Message sent! (Demo only)');
}

// Store meetings data globally to access it later
let allMeetings = [];
let currentYearMonth = {
    year: new Date().getFullYear(),
    month: new Date().getMonth()
};

// Schedule functions
function loadMeetings() {
    // For demo, we'll just show sample meetings
    allMeetings = [
        {
            id: 1,
            title: 'Weekly Club Meeting',
            description: 'Our regular weekly meeting to discuss projects and plan activities.',
            meeting_date: new Date().toISOString().split('T')[0], // Today
            start_time: '15:00',
            end_time: '16:00',
            location: 'Room 203',
            creator: { username: 'Club Leader' }
        },
        {
            id: 2,
            title: 'Coding Workshop',
            description: 'Hands-on workshop on building web applications.',
            meeting_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Next week
            start_time: '14:00',
            end_time: '16:00',
            location: 'Computer Lab',
            creator: { username: 'Club Leader' }
        }
    ];

    renderCalendar();
    renderUpcomingMeetings();
}

function renderCalendar() {
    const year = currentYearMonth.year;
    const month = currentYearMonth.month;

    // Update month display
    const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June', 
        'July', 'August', 'September', 'October', 'November', 'December'
    ];
    document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

    // Get first day of month and last day of month
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);

    // Get day of week for first day (0 = Sunday, 6 = Saturday)
    const firstDayOfWeek = firstDay.getDay();

    // Calculate days from previous month to show
    const daysFromPrevMonth = firstDayOfWeek;

    // Calculate total cells needed (previous month days + current month days)
    const totalDays = daysFromPrevMonth + lastDay.getDate();

    // Calculate rows needed (7 days per row)
    const rows = Math.ceil(totalDays / 7);

    // Get calendar body element
    const calendarBody = document.getElementById('calendar-body');
    calendarBody.innerHTML = '';

    // Get current date for highlighting today
    const today = new Date();
    const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;

    // Create calendar cells
    let date = new Date(year, month, 1 - firstDayOfWeek);

    for (let i = 0; i < rows * 7; i++) {
        const dayElement = document.createElement('div');
        dayElement.classList.add('calendar-day');

        // Check if this day is from the current month
        const isCurrentMonthDay = date.getMonth() === month;
        if (!isCurrentMonthDay) {
            dayElement.classList.add('other-month');
        }

        // Check if this day is today
        if (isCurrentMonth && date.getDate() === today.getDate() && isCurrentMonthDay) {
            dayElement.classList.add('today');
        }

        // Add day number
        const dayNumber = document.createElement('div');
        dayNumber.classList.add('calendar-day-number');
        dayNumber.textContent = date.getDate();
        dayElement.appendChild(dayNumber);

        // Add container for events
        const eventsContainer = document.createElement('div');
        eventsContainer.classList.add('calendar-day-events');

        // Find meetings for this day
        const dateString = date.toISOString().split('T')[0];
        const dayMeetings = allMeetings.filter(meeting => meeting.meeting_date === dateString);

        // Add meetings to the day
        dayMeetings.forEach(meeting => {
            const eventElement = document.createElement('div');
            eventElement.classList.add('calendar-event');
            eventElement.textContent = meeting.title;
            eventElement.setAttribute('data-meeting-id', meeting.id);
            eventElement.addEventListener('click', () => openViewMeetingModal(meeting.id));
            eventsContainer.appendChild(eventElement);
        });

        dayElement.appendChild(eventsContainer);
        calendarBody.appendChild(dayElement);

        // Move to next day
        date.setDate(date.getDate() + 1);
    }
}

function renderUpcomingMeetings() {
    const upcomingContainer = document.getElementById('upcoming-meetings');

    // Filter meetings that are upcoming (today or later)
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const upcomingMeetings = allMeetings.filter(meeting => {
        const meetingDate = new Date(meeting.meeting_date);
        return meetingDate >= today;
    });

    // Sort by date (closest first)
    upcomingMeetings.sort((a, b) => {
        const dateA = new Date(a.meeting_date);
        const dateB = new Date(b.meeting_date);
        return dateA - dateB;
    });

    if (upcomingMeetings.length === 0) {
        upcomingContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-calendar-times"></i>
                <p>No upcoming meetings scheduled.</p>
            </div>
        `;
        return;
    }

    upcomingContainer.innerHTML = '';

    upcomingMeetings.forEach(meeting => {
        const meetingCard = document.createElement('div');
        meetingCard.classList.add('meeting-card');
        meetingCard.setAttribute('data-meeting-id', meeting.id);

        // Format date and time
        const meetingDate = new Date(meeting.meeting_date);
        const formattedDate = meetingDate.toLocaleDateString('en-US', { 
            weekday: 'short', 
            month: 'short', 
            day: 'numeric' 
        });

        // Check if it's today
        const isToday = meetingDate.toDateString() === new Date().toDateString();
        const dateLabel = isToday ? 'Today' : formattedDate;

        meetingCard.innerHTML = `
            <div class="meeting-card-header">
                <h3>${meeting.title}</h3>
                <span class="meeting-date">${dateLabel}</span>
            </div>
            <div class="meeting-meta">
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>${meeting.start_time}${meeting.end_time ? ' - ' + meeting.end_time : ''}</span>
                </div>
                ${meeting.location ? `
                <div class="meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${meeting.location}</span>
                </div>
                ` : ''}
            </div>
            <div class="meeting-actions">
                <button class="btn-primary btn-sm" onclick="openViewMeetingModal(${meeting.id})">
                    <i class="fas fa-eye"></i> View Details
                </button>
            </div>
        `;

        upcomingContainer.appendChild(meetingCard);
    });
}

function prevMonth() {
    currentYearMonth.month--;
    if (currentYearMonth.month < 0) {
        currentYearMonth.month = 11;
        currentYearMonth.year--;
    }
    renderCalendar();
}

function nextMonth() {
    currentYearMonth.month++;
    if (currentYearMonth.month > 11) {
        currentYearMonth.month = 0;
        currentYearMonth.year++;
    }
    renderCalendar();
}

function createMeeting() {
    const title = document.getElementById('meetingTitle').value.trim();
    const description = document.getElementById('meetingDescription').value.trim();
    const meetingDate = document.getElementById('meetingDate').value;
    const startTime = document.getElementById('startTime').value;
    const endTime = document.getElementById('endTime').value;
    const location = document.getElementById('meetingLocation').value.trim();
    const meetingLink = document.getElementById('meetingLink').value.trim();

    if (!title || !meetingDate || !startTime) {
        showToast('error', 'Title, date and start time are required');
        return;
    }

    // For demo purposes, we'll just add it to our local array
    const newMeeting = {
        id: allMeetings.length + 1,
        title,
        description,
        meeting_date: meetingDate,
        start_time: startTime,
        end_time: endTime || null,
        location,
        meeting_link: meetingLink,
        creator: { username: 'You' }
    };

    allMeetings.push(newMeeting);

    showToast('success', 'Meeting scheduled successfully');
    closeCreateMeetingModal();

    // Update the displays
    renderCalendar();
    renderUpcomingMeetings();
}

function openViewMeetingModal(meetingId) {
    const meeting = allMeetings.find(m => m.id === meetingId);
    if (!meeting) {
        showToast('error', 'Meeting not found');
        return;
    }

    document.getElementById('viewMeetingTitle').textContent = meeting.title;

    // Format date and time
    const meetingDate = new Date(meeting.meeting_date);
    const formattedDate = meetingDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });

    let timeString = `${meeting.start_time}`;
    if (meeting.end_time) {
        timeString += ` - ${meeting.end_time}`;
    }

    document.getElementById('viewMeetingTime').textContent = `${formattedDate}, ${timeString}`;

    // Set location
    if (meeting.location) {
        document.getElementById('viewMeetingLocation').textContent = meeting.location;
    } else {
        document.getElementById('viewMeetingLocation').textContent = 'No location specified';
    }

    // Set meeting link
    const linkContainer = document.getElementById('viewMeetingLinkContainer');
    if (meeting.meeting_link) {
        linkContainer.style.display = 'flex';
        const linkElement = document.getElementById('viewMeetingLink');
        linkElement.href = meeting.meeting_link;
        linkElement.textContent = 'Join Meeting';
    } else {
        linkContainer.style.display = 'none';
    }

    // Set creator
    document.getElementById('viewMeetingCreator').textContent = meeting.creator.username;

    // Set description
    if (meeting.description) {
        document.getElementById('viewMeetingDescription').textContent = meeting.description;
    } else {
        document.getElementById('viewMeetingDescription').textContent = 'No description provided.';
    }

    // Store meeting ID for edit/delete operations
    document.getElementById('currentMeetingId').value = meeting.id;

    openModal('viewMeetingModal');
}

// Projects tab functionality
function loadProjects() {
    const clubId = getClubId();
    if (!clubId) return;

    const projectsContainer = document.getElementById('projects-container');
    if (!projectsContainer) return;

    projectsContainer.innerHTML = `
        <div class="loading-state">
            <div class="loading-spinner"></div>
            <p>Loading member projects...</p>
        </div>
    `;

    // For demo purposes, we'll just show some placeholder projects
    setTimeout(() => {
        projectsContainer.innerHTML = `
            <div class="project-card">
                <div class="project-header">
                    <h3>Personal Portfolio</h3>
                </div>
                <div class="project-preview web">
                    <i class="fas fa-globe fa-3x" style="opacity: 0.5;"></i>
                </div>
                <div class="project-content">
                    <div class="project-meta">
                        <span><i class="fas fa-user"></i> John Doe</span>
                        <span><i class="fas fa-globe"></i> Web Project</span>
                        <span><i class="fas fa-clock"></i> Updated: Yesterday</span>
                    </div>
                </div>
                <div class="project-actions">
                    <div class="project-actions-left">
                        <a href="#" target="_blank" class="btn-primary btn-sm">View</a>
                        <a href="#" target="_blank" class="btn-secondary btn-sm">Preview</a>
                    </div>
                </div>
            </div>

            <div class="project-card featured">
                <div class="project-header">
                    <h3>Weather App</h3>
                </div>
                <div class="project-preview web">
                    <i class="fas fa-globe fa-3x" style="opacity: 0.5;"></i>
                </div>
                <div class="project-content">
                    <div class="project-meta">
                        <span><i class="fas fa-user"></i> Jane Smith</span>
                        <span><i class="fas fa-globe"></i> Web Project</span>
                        <span><i class="fas fa-clock"></i> Updated: Today</span>
                    </div>
                </div>
                <div class="project-actions">
                    <div class="project-actions-left">
                        <a href="#" target="_blank" class="btn-primary btn-sm">View</a>
                        <a href="#" target="_blank" class="btn-secondary btn-sm">Preview</a>
                    </div>
                </div>
            </div>

            <div class="project-card">
                <div class="project-header">
                    <h3>Data Analysis Tool</h3>
                </div>
                <div class="project-preview python">
                    <i class="fas fa-terminal fa-3x" style="opacity: 0.5;"></i>
                </div>
                <div class="project-content">
                    <div class="project-meta">
                        <span><i class="fas fa-user"></i> Alex Johnson</span>
                        <span><i class="fas fa-terminal"></i> Python Project</span>
                        <span><i class="fas fa-clock"></i> Updated: Last week</span>
                    </div>
                </div>
                <div class="project-actions">
                    <div class="project-actions-left">
                        <a href="#" target="_blank" class="btn-primary btn-sm">View</a>
                        <a href="#" target="_blank" class="btn-secondary btn-sm">Preview</a>
                    </div>
                </div>
            </div>
        `;
    }, 1000);
}

function toggleFeaturedOnly() {
    // This is a demo implementation
    const button = document.getElementById('featured-toggle-text');
    const currentText = button.textContent;

    if (currentText === 'Show Featured Only') {
        button.textContent = 'Show All Projects';
        // Filter to show only featured projects would go here
        showToast('info', 'Showing featured projects only (demo)');
    } else {
        button.textContent = 'Show Featured Only';
        // Reset filter to show all projects would go here
        showToast('info', 'Showing all projects (demo)');
    }
}

function filterProjects() {
    // Demo implementation
    const searchText = document.getElementById('project-search').value.toLowerCase();
    showToast('info', `Filtering for "${searchText}" (demo)`);
}

// Initialize dashboard as active tab by default
document.addEventListener('DOMContentLoaded', function() {
    // Check if there's a specific tab to open from URL hash
    const hash = window.location.hash.substr(1);
    if (hash && document.getElementById(hash)) {
        openTab(hash);
    } else {
        openTab('dashboard');
    }
});
    </script>
</body>
</html>

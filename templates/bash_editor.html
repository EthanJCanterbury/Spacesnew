
{% extends "base.html" %}

{% block head %}
<title>Bash Terminal - Hack Club Spaces</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/bash-editor.css') }}">
{% endblock %}

{% block content %}
<div class="bash-editor-container">
    <div class="bash-editor-header">
        <h1>Bash Terminal Emulator</h1>
        <div class="controls">
            <span id="status">Terminal ready</span>
        </div>
    </div>

    <div class="terminal-container">
        <div id="terminal"></div>
    </div>

    <div class="info-panel">
        <div class="info-box">
            <h3>About Bash Terminal</h3>
            <p>This is a terminal emulator running directly in your browser.</p>
            <p>Use common bash commands to navigate and work with files.</p>
        </div>

        <div class="info-box">
            <h3>Quick Tips</h3>
            <ul>
                <li>Use common bash commands: <code>ls</code>, <code>cd</code>, <code>mkdir</code>, <code>cat</code>, etc.</li>
                <li>Press Ctrl+C to interrupt commands</li>
                <li>Type <code>clear</code> to clear the terminal</li>
            </ul>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm/5.3.0/xterm.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xterm-addon-fit/0.8.0/xterm-addon-fit.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Create Terminal
        const term = new Terminal({
            cursorBlink: true,
            fontFamily: 'monospace',
            fontSize: 14,
            theme: {
                background: '#000',
                foreground: '#f0f0f0'
            }
        });
        
        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        
        // Open terminal and fit it to container
        term.open(document.getElementById('terminal'));
        fitAddon.fit();
        
        // Handle terminal resize
        window.addEventListener('resize', () => {
            fitAddon.fit();
        });
        
        // Initial welcome message
        term.writeln('Welcome to Bash Terminal Emulator');
        term.writeln('Type commands below:');
        term.writeln('');
        
        // Command history
        let history = [];
        let historyIndex = 0;
        
        // Current command buffer
        let command = '';
        let prompt = '$ ';
        
        // Write prompt
        function writePrompt() {
            term.write('\r\n' + prompt);
        }
        
        // Initialize with a prompt
        writePrompt();
        
        // Process commands
        function processCommand(cmd) {
            if (cmd.trim() === '') {
                return;
            }
            
            // Add to history
            history.push(cmd);
            historyIndex = history.length;
            
            // Process command (this is a simple emulation)
            switch(cmd.trim()) {
                case 'clear':
                    term.clear();
                    break;
                case 'ls':
                    term.writeln('Documents  Downloads  Pictures  example.txt');
                    break;
                case 'pwd':
                    term.writeln('/home/user');
                    break;
                case 'date':
                    term.writeln(new Date().toString());
                    break;
                case 'help':
                    term.writeln('Available commands: clear, ls, pwd, date, help');
                    term.writeln('This is a simple terminal emulator.');
                    break;
                default:
                    term.writeln(`Command not found: ${cmd}`);
            }
        }
        
        // Handle key input
        term.onKey(({ key, domEvent }) => {
            const printable = !domEvent.altKey && !domEvent.ctrlKey && !domEvent.metaKey;
            
            if (domEvent.keyCode === 13) { // Enter
                term.writeln('');
                processCommand(command);
                command = '';
                writePrompt();
            } else if (domEvent.keyCode === 8) { // Backspace
                if (command.length > 0) {
                    command = command.substring(0, command.length - 1);
                    term.write('\b \b');
                }
            } else if (domEvent.keyCode === 38) { // Up arrow
                if (historyIndex > 0) {
                    historyIndex--;
                    // Clear current command
                    term.write('\r' + prompt + ' '.repeat(command.length) + '\r' + prompt);
                    command = history[historyIndex];
                    term.write(command);
                }
            } else if (domEvent.keyCode === 40) { // Down arrow
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    // Clear current command
                    term.write('\r' + prompt + ' '.repeat(command.length) + '\r' + prompt);
                    command = history[historyIndex];
                    term.write(command);
                } else if (historyIndex === history.length - 1) {
                    historyIndex++;
                    // Clear current command
                    term.write('\r' + prompt + ' '.repeat(command.length) + '\r' + prompt);
                    command = '';
                }
            } else if (printable) {
                command += key;
                term.write(key);
            }
        });
    });
</script>
{% endblock %}

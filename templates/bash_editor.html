
{% extends "base.html" %}

{% block head %}
<title>Bash Editor - Hack Club Spaces</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/bash-editor.css') }}">
{% endblock %}

{% block content %}
<div class="bash-editor-container">
    <div class="bash-editor-header">
        <h1>Bash Terminal Emulator</h1>
        <div class="controls">
            <button id="start-emulator" class="btn-primary">Start Emulator</button>
            <button id="reset-emulator" class="btn-danger" disabled>Reset</button>
            <span id="status">Ready to start</span>
        </div>
    </div>
    
    <div class="emulator-container">
        <div id="screen_container">
            <div id="loading">Loading emulator... Please wait</div>
            <div id="screen"></div>
        </div>
        
        <div class="info-panel">
            <div class="info-box">
                <h3>About Bash Editor</h3>
                <p>This is a Debian Linux terminal emulator running in your browser. It uses <a href="https://github.com/copy/v86" target="_blank">v86</a> to emulate x86 hardware.</p>
                <p>Note: This environment runs entirely in your browser and changes are not saved to your Spaces account.</p>
            </div>
            
            <div class="info-box">
                <h3>Quick Tips</h3>
                <ul>
                    <li>Username: <code>user</code></li>
                    <li>Password: <code>passw0rd</code></li>
                    <li>Use common bash commands: <code>ls</code>, <code>cd</code>, <code>mkdir</code>, <code>vim</code>, etc.</li>
                    <li>Press CTRL+C to cancel commands</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script src="https://copy.sh/v86/build/libv86.js"></script>
<script>
    // Wait for DOM content to be loaded
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, checking if V86Starter is defined:', typeof V86Starter);
        const startButton = document.getElementById('start-emulator');
        const resetButton = document.getElementById('reset-emulator');
        const statusElement = document.getElementById('status');
        const loadingElement = document.getElementById('loading');
        let emulator = null;
        
        function updateStatus(message) {
            statusElement.textContent = message;
        }
        
        startButton.addEventListener('click', function() {
            startButton.disabled = true;
            updateStatus('Loading Debian Linux...');
            loadingElement.style.display = 'flex';
            
            emulator = new V86Starter({
                wasm_path: "https://copy.sh/v86/build/v86.wasm",
                memory_size: 128 * 1024 * 1024,
                vga_memory_size: 8 * 1024 * 1024,
                screen_container: document.getElementById('screen'),
                initial_state: {
                    url: "https://copy.sh/v86/images/debian-state-base.bin.zst",
                },
                bzimage_initrd_from_filesystem: false,
                autostart: true,
                disable_speaker: true,
                filesystem: {},
                network_relay_url: "wss://relay.widgetry.org/",
                boot_order: 0x132
            });
            
            emulator.add_listener("emulator-ready", function() {
                updateStatus('Emulator ready');
                resetButton.disabled = false;
                loadingElement.style.display = 'none';
            });
            
            emulator.add_listener("emulator-started", function() {
                updateStatus('Emulator started');
            });
        });
        
        resetButton.addEventListener('click', function() {
            if (confirm('This will reset the emulator and all unsaved work will be lost. Continue?')) {
                if (emulator) {
                    emulator.stop();
                    emulator = null;
                }
                startButton.disabled = false;
                resetButton.disabled = true;
                updateStatus('Ready to start');
                loadingElement.style.display = 'none';
                document.getElementById('screen').innerHTML = '';
            }
        });
    });
    });
</script>
{% endblock %}

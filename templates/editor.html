{% extends "base.html" %}

{% block body_class %}editor-page{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/eclipse.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.min.css">

<link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/github.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/hackatime-badge.css') }}">
{% endblock %}

{% block content %}
<div id="loading-overlay" class="loading-overlay">
    <div class="particles-container" id="particles-js"></div>
    <div class="loading-content">
        <div class="loading-spinner-container">
            <div class="loading-spinner"></div>
            <div class="loading-spinner-shadow"></div>
        </div>
        <div class="loading-text-container">
            <p class="loading-text">Building Your Space :D</p>
        </div>
        <div class="loading-progress-container">
            <div class="loading-progress-bar">
                <div class="loading-progress-fill"></div>
            </div>
        </div>
        <div class="loading-facts">
            <div class="fact-container">
                <p class="loading-fact">Building your digital canvas...</p>
            </div>
        </div>
    </div>
    <div class="loading-glow"></div>
    <div class="loading-corners">
        <div class="corner top-left"></div>
        <div class="corner top-right"></div>
        <div class="corner bottom-left"></div>
        <div class="corner bottom-right"></div>
    </div>
</div>
<div class="editor-container split-layout">
    <div class="editor-topbar">
        <div class="topbar-left">
            <a href="{{ url_for('welcome') }}" class="btn-icon" title="Back to Dashboard">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>{{ site.name }}</h1>
        </div>
        <div class="topbar-actions">
            <button id="undoBtn" class="btn-icon" title="Undo (Ctrl+Z)" disabled>
                <i class="fas fa-undo"></i>
            </button>
            <button id="redoBtn" class="btn-icon" title="Redo (Ctrl+Y)" disabled>
                <i class="fas fa-redo"></i>
            </button>

            <div class="dropdown">
                <button class="btn-icon dropdown-toggle" title="Editor Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-section">
                        <label for="themeSelector">Theme:</label>
                        <select id="themeSelector" onchange="changeEditorTheme(this.value)">
                            <option value="eclipse">Eclipse</option>
                            <option value="monokai">Monokai</option>
                            <option value="dracula">Dracula</option>
                            <option value="material">Material</option>
                            <option value="mdn-like">MDN-like</option>
                            <option value="solarized dark">Solarized Dark</option>
                            <option value="solarized light">Solarized Light</option>
                        </select>
                    </div>
                    <div class="dropdown-section">
                        <label for="fontSizeSelector">Font Size:</label>
                        <select id="fontSizeSelector" onchange="changeEditorFontSize(this.value)">
                            <option value="12px">Small</option>
                            <option value="14px" selected>Medium</option>
                            <option value="16px">Large</option>
                            <option value="18px">X-Large</option>
                        </select>
                    </div>
                    <div class="dropdown-section checkbox">
                        <label>
                            <input type="checkbox" id="wordWrapToggle" checked onchange="toggleWordWrap(this.checked)">
                            Word Wrap
                        </label>
                    </div>
                    <div class="dropdown-section checkbox">
                        <label>
                            <input type="checkbox" id="lintToggle" onchange="toggleLinting(this.checked)">
                            Lint Code
                        </label>
                    </div>
                </div>
            </div>

            <button id="searchBtn" class="btn-icon" title="Search (Ctrl+F)" onclick="focusSearch()">
                <i class="fas fa-search"></i>
            </button>

            {% if site.site_type == 'web' %}
            <button id="tutorialBtn" class="btn-primary" onclick="openTutorialModal()" style="background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);">
                <i class="fas fa-graduation-cap"></i>
                Tutorial
            </button>
            <button id="yswsBtn" class="btn-primary" onclick="openYSWSModal()">
                <i class="fa-solid fa-gift"></i>
                YSWS
            </button>
            <button id="analyticsBtn" class="btn-primary" onclick="openModal('analyticsModal')">
                <i class="fas fa-chart-line"></i>
                Analytics
            </button>
            <button id="orphyBtn" class="btn-primary" onclick="openOrphyChat()">
                <i class="fas fa-magic"></i>
                Orphy
            </button>
            {% elif site.site_type == 'python' %}
            <button id="runBtn" class="btn-primary" onclick="runCode()">
                <i class="fas fa-play"></i>
                Run
            </button>
            <button id="formatterBtn" class="btn-primary" onclick="formatCode()">
                <i class="fas fa-magic"></i>
                Format
            </button>
            {% endif %}

            <button id="saveBtn" class="btn-primary" onclick="saveContent()">
                <i class="fas fa-save"></i>
                Save Changes
            </button>

            <button id="gitBtn" class="btn-primary" onclick="GitHubManager.openModal()" style="background: linear-gradient(135deg, #fa8072 0%, #e57363 100%);">
                <i class="fab fa-github"></i>
                Git
            </button>
        </div>
    </div>
    <div class="editor-main">
        <div class="editor-pane">
            {% if site.site_type == 'web' %}
            <div class="file-tabs">
                <button class="file-tab active" data-filename="index.html" data-filetype="html">index.html</button>
                <button class="file-tab" data-filename="styles.css" data-filetype="css">styles.css</button>
                <button class="file-tab" data-filename="script.js" data-filetype="js">script.js</button>
                <button class="file-tab-add" title="Add new file" id="addFileBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div id="new-file-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Create New File</h2>
                        <button class="close-btn">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="newFilename">Filename (include extension):</label>
                            <input type="text" id="newFilename" placeholder="e.g., about.html, styles.css, script.js">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-secondary" id="cancelNewFile">Cancel</button>
                        <button class="btn-primary" id="createNewFile">Create</button>
                    </div>
                </div>
            </div>
            {% endif %}
            <textarea id="editor">{{ site.html_content }}</textarea>
            <input type="hidden" id="site-slug" value="{{ site.slug }}">
            <input type="hidden" id="site-id" value="{{ site.id }}">
            <input type="hidden" id="site-type" value="{{ site.site_type }}">
            <div class="editor-statusbar">
                <div class="status-section">
                    <div class="status-item" id="cursorPosition">
                        <i class="fas fa-map-marker-alt"></i> Line 1, Column 1
                    </div>
                    <div class="status-item" id="fileSizeInfo">
                        <i class="fas fa-file-alt"></i> <span id="fileSize">0</span> bytes
                    </div>
                </div>
                <div class="status-section">
                    <div class="status-item" id="editorMode">
                        {{ site.site_type|upper }}
                    </div>
                    <div class="status-item" id="editorSettings">
                        <i class="fas fa-keyboard"></i>
                        <a href="#" onclick="showKeyboardShortcutsModal(); return false;">Shortcuts</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="preview-pane">
            {% if site.site_type == 'web' %}
            <div class="browser-frame">
                <div class="browser-header">
                    <div class="browser-address" style="display: flex; align-items: center; width: 100%;">
                        <div style="flex: 1"></div>
                        <div style="display: flex; align-items: center; position: absolute; left: 50%; transform: translateX(-50%); z-index: 10000;">
                            <i class="fas fa-lock"></i>
                            <span class="browser-url">https://hackclub.space/s/{{ site.slug|default('', true) }}</span>
                            <button id="openDeployedSiteBtn" class="btn-icon" title="Open deployed site in new tab" onclick="openDeployedSite()" style="z-index: 10000;">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                        <div style="flex: 1; display: flex; justify-content: flex-end; gap: 8px; z-index: 2; position: relative;">
                            <button id="deployBtn" title="Deploy your site" onclick="deploySite()">
                                <i class="fas fa-rocket" style="color: white;"></i> Deploy
                            </button>
                            <button id="runBtn" title="Run your code" onclick="saveContent()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none; border-radius: 4px; padding: 5px 12px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                                <i class="fas fa-play" style="color: white;"></i> Run
                            </button>
                        </div>
                    </div>
                </div>
                <iframe id="preview" frameborder="0"></iframe>
            </div>
            {% elif site.site_type == 'python' %}
            <div class="console-frame">
                <div class="console-header">
                    <div class="console-title">
                        <i class="fas fa-terminal"></i>
                        Output Console
                    </div>
                </div>
                <pre id="output" class="console-output">Run your code to see the output here!</pre>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div id="toast-container"></div>

<div id="githubModal" class="modal" style="display: none; opacity: 1; visibility: visible;">
    <div class="github-modal-content">
        <div class="github-modal-header">
            <h2><i class="fab fa-github"></i> GitHub Integration</h2>
            <button class="close-btn" onclick="GitHubManager.closeModal()">&times;</button>
        </div>
        <div class="github-modal-body" id="githubModalBody">
            <!-- Content will be dynamically loaded by GitHubManager -->
        </div>
    </div>
</div>

{% if site.site_type == 'web' %}
<div id="analyticsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Site Analytics</h2>
            <button class="close-btn" onclick="closeModal('analyticsModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="analytics-summary">
                <div class="analytics-count">
                    <span>1234</span>
                    <label>Total Views</label>
                </div>
                <div class="analytics-actions">
                    <div class="analytics-toggle">
                        <label for="analytics-toggle">Enable Analytics:</label>
                        <label class="switch">
                            <input type="checkbox" id="analytics-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <button id="clearAnalyticsBtn" class="btn-danger">
                        <i class="fas fa-trash"></i>
                        Clear Analytics
                    </button>
                </div>
            </div>
            <div class="analytics-info">
                <p><i class="fas fa-info-circle"></i> View count shows total visits to your site.</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div id="deployModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-rocket"></i> Deploy Your Site</h2>
            <button class="close-btn" onclick="closeDeployModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Your site is available at the following URLs:</p>
            <div id="deployUrlsContainer">
                {% set siteSlug = site.slug %}
                {% set defaultDomain = 'hackclub.space' %}
                {% set domains = ['hackclub.space', 'imahacker.lol', 'myhack.club', 'hackclub.me'] %}

                {% for domain in domains %}
                    {% set url = 'https://' + domain + '/s/' + siteSlug %}
                    <div class="site-url">
                        <input type="text" value="{{ url }}" readonly>
                        <button onclick="navigator.clipboard.writeText('{{ url }}')" class="btn-copy">Copy</button>
                        <a href="{{ url }}" target="_blank" class="btn-icon" title="Open in new tab">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div class="modal-info">
                <p><strong>Note:</strong> Your default domain is <code>https://{{ defaultDomain }}/s/{{ siteSlug }}</code></p>
                {% if request.host == 'spaces.hackclub.com' %}
                    <p><strong>Warning:</strong> Public hosting is not available on spaces.hackclub.com domain</p>
                {% endif %}
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeDeployModal()">Close</button>
        </div>
    </div>
</div>


<script src="{{ url_for('static', filename='js/particles.min.js') }}"></script>

<div id="keyboardShortcutsModal" class="modal">
    <div class="modal-content shortcuts-modal">
        <div class="modal-header">
            <h2><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h2>
            <button class="close-btn" onclick="closeKeyboardShortcutsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="shortcuts-list">
                <div class="shortcut-category">
                    <h4>Editor</h4>
                    <div class="shortcut-item">
                        <span>Save</span>
                        <span class="shortcut-key">Ctrl+S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Undo</span>
                        <span class="shortcut-key">Ctrl+Z</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Redo</span>
                        <span class="shortcut-key">Ctrl+Y</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Fold Code</span>
                        <span class="shortcut-key">Alt+F</span>
                    </div>
                </div>
                <div class="shortcut-category">
                    <h4>Search</h4>
                    <div class="shortcut-item">
                        <span>Find</span>
                        <span class="shortcut-key">Ctrl+F</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Find Next</span>
                        <span class="shortcut-key">Ctrl+G</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Find Previous</span>
                        <span class="shortcut-key">Shift+Ctrl+G</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Replace</span>
                        <span class="shortcut-key">Ctrl+H</span>
                    </div>
                </div>
            </div>
            {% if site.site_type == 'python' %}
            <div class="shortcut-category">
                <h4>Python</h4>
                <div class="shortcut-item">
                    <span>Run Code</span>
                    <span class="shortcut-key">Ctrl+Enter</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>


<div id="orphy-widget" class="orphy-widget">
    <div class="orphy-container">
        <div class="orphy-header" id="orphy-header">
            <div class="orphy-title">
                <h2>Orphy <span class="orphy-emoji">🦖</span></h2>
            </div>
            <button class="orphy-close-btn" onclick="closeOrphyChat()">&times;</button>
        </div>
        <div class="orphy-chat">
            <div class="orphy-messages" id="orphyMessages"></div>
        </div>
        <div class="orphy-input">
            <textarea id="orphyInput" placeholder="Ask Orphy a question about your code..." rows="2"></textarea>
            <button class="orphy-send-btn" onclick="sendOrphyMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- Include GitHub CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/github-buttons.css') }}">
<div id="tutorial-widget" style="display: none; position: fixed; width: 600px; max-width: 90%; height: auto; max-height: 80vh; background: white; border-radius: 12px; box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2); z-index: 9999; opacity: 0; transition: opacity 0.3s ease; overflow: hidden;">
    <div class="orphy-header" style="background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%); cursor: grab; border-radius: 12px 12px 0 0;">
        <div class="orphy-title">
            <h2>Web Development Tutorial <span class="orphy-emoji">📚</span></h2>
        </div>
        <button class="orphy-close-btn" onclick="closeTutorialModal()">&times;</button>
    </div>
    <div style="overflow-y: auto; max-height: 70vh; background-color: white; padding: 20px; border-radius: 0 0 12px 12px;">
        <div class="tutorial-navigation" style="display: flex; justify-content: center; margin-bottom: 20px;">
            <button id="prev-tutorial" onclick="prevTutorialStep()" class="btn-secondary" style="margin-right: 10px; font-size: 14px; padding: 6px 12px;" disabled>
                <i class="fas fa-arrow-left"></i> Previous
            </button>
            <div style="display: flex; align-items: center; margin: 0 15px;">
                <span id="tutorial-step-indicator">1/10</span>
            </div>
            <button id="next-tutorial" onclick="nextTutorialStep()" class="btn-primary" style="margin-left: 10px; font-size: 14px; padding: 6px 12px;">
                Next <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <div class="tutorial-content">
            <div class="tutorial-step" data-step="1" style="display: block;">
                <h3 style="color: #4e54c8; margin-top: 0;">Getting Started with HTML</h3>
                <p>HTML (HyperText Markup Language) is the backbone of any website. It defines the structure and content of your web page.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Basic HTML Structure:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My First Website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;p&gt;This is my first web page.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
                </div>

                <p><strong>Try it:</strong> Type this structure into your editor to create a basic webpage.</p>
            </div>

            <div class="tutorial-step" data-step="2" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Adding More Content</h3>
                <p>Let's add more elements to make your page more interesting and informative.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Common HTML Elements:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><strong>&lt;h1&gt; to &lt;h6&gt;</strong> - Headings (h1 is largest, h6 is smallest)</li>
                        <li><strong>&lt;p&gt;</strong> - Paragraph</li>
                        <li><strong>&lt;a&gt;</strong> - Links to other pages</li>
                        <li><strong>&lt;img&gt;</strong> - Images</li>
                        <li><strong>&lt;ul&gt; and &lt;ol&gt;</strong> - Unordered and ordered lists</li>
                        <li><strong>&lt;div&gt;</strong> - Container for grouping elements</li>
                    </ul>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Example:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;body&gt;
  &lt;h1&gt;My Website&lt;/h1&gt;
  &lt;h2&gt;Welcome to my page!&lt;/h2&gt;

  &lt;p&gt;This is a paragraph with &lt;strong&gt;bold text&lt;/strong&gt; and &lt;em&gt;italic text&lt;/em&gt;.&lt;/p&gt;

  &lt;h3&gt;My Favorite Foods&lt;/h3&gt;
  &lt;ul&gt;
    &lt;li&gt;Pizza&lt;/li&gt;
    &lt;li&gt;Ice Cream&lt;/li&gt;
    &lt;li&gt;Tacos&lt;/li&gt;
  &lt;/ul&gt;

  &lt;h3&gt;Check out this image:&lt;/h3&gt;
  &lt;img src="https://hackclub.com/hackclub-flag.svg" alt="Hack Club Flag" width="300"&gt;

  &lt;p&gt;&lt;a href="https://hackclub.com"&gt;Visit Hack Club&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;</pre>
                </div>
            </div>

            <div class="tutorial-step" data-step="3" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Introduction to CSS</h3>
                <p>CSS (Cascading Style Sheets) is used to style your HTML elements and make your website look attractive.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Adding CSS:</h4>
                    <p>You can add CSS in three ways:</p>
                    <ol style="padding-left: 20px; line-height: 1.6;">
                        <li><strong>Inline</strong> - Using the style attribute in HTML elements</li>
                        <li><strong>Internal</strong> - Using the &lt;style&gt; element in the &lt;head&gt; section</li>
                        <li><strong>External</strong> - Using a separate CSS file</li>
                    </ol>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Basic CSS Example (Internal):</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;head&gt;
  &lt;title&gt;My Styled Website&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    h1 {
      color: #4e54c8;
      text-align: center;
    }

    p {
      color: #333;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
  &lt;/style&gt;
&lt;/head&gt;</pre>
                </div>
            </div>

            <div class="tutorial-step" data-step="4" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Putting It All Together</h3>
                <p>Now let's combine HTML and CSS to create a complete webpage.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Complete Webpage Example:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
  &lt;title&gt;My Awesome Website&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      margin: 0;
      background-color: #f5f5f5;
      color: #333;
    }

    .header {
      background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);
      color: white;
      text-align: center;
      padding: 60px 20px;
    }

    .header h1 {
      margin: 0;
      font-size: 3rem;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section {
      margin-bottom: 30px;
    }

    .section h2 {
      color: #4e54c8;
      border-bottom: 2px solid #8f94fb;
      padding-bottom: 10px;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }

    .gallery img {
      width: 200px;
      height: 150px;
      object-fit: cover;
      border-radius: 5px;
      transition: transform 0.3s;
    }

    .gallery img:hover {
      transform: scale(1.05);
    }

    .footer {
      text-align: center;
      padding: 20px;
      background: #333;
      color: white;
      margin-top: 30px;
    }

    a {
      color: #4e54c8;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="header"&gt;
    &lt;h1&gt;Welcome to My Website&lt;/h1&gt;
    &lt;p&gt;A place to learn and create&lt;/p&gt;
  &lt;/div&gt;

  &lt;div class="container"&gt;
    &lt;div class="section"&gt;
      &lt;h2&gt;About Me&lt;/h2&gt;
      &lt;p&gt;Hello! I'm a web developer learning HTML and CSS. This is my first website created with Hack Club Spaces.&lt;/pgt;.</p>
    &lt;/div&gt;

    &lt;div class="section"&gt;
      &lt;h2&gt;My Interests&lt;/h2&gt;
      &lt;ul&gt;
        &lt;li&gt;Web Development&lt;/li&gt;
        &lt;li&gt;Graphic Design&lt;/li&gt;
        &lt;li&gt;Photography&lt;/li&gt;
        &lt;li&gt;Artificial Intelligence&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;

    &lt;div class="section"&gt;
      &lt;h2&gt;Photo Gallery&lt;/h2&gt;
      &lt;div class="gallery"&gt;
        &lt;img src="https://source.unsplash.com/random/200x150?nature" alt="Nature"&gt;
        &lt;img src="https://source.unsplash.com/random/200x150?technology" alt="Technology"&gt;
        &lt;img src="https://source.unsplash.com/random/200x150?art" alt="Art"&gt;
      &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class="section"&gt;
      &lt;h2&gt;Contact Me&lt;/h2&gt;
      &lt;p&gt;You can reach me at: &lt;a href="mailto:example@email.com"&gt;example@email.com&lt;/a&gt;&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class="footer"&gt;
    &lt;p&gt;&copy; 2023 My Website. All rights reserved. Made with Hack Club Spaces.&lt;/p&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>
                </div>
            </div>

            <div class="tutorial-step" data-step="5" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Adding Interactivity with JavaScript</h3>
                <p>JavaScript allows you to add dynamic behavior to your website, making it more engaging for users.</p>
            </div>
            <div class="tutorial-step" data-step="6" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Handling Events</h3>
                <p>Learn how to respond to user interactions such as clicks and mouseovers.</p>
            </div>
            <div class="tutorial-step" data-step="7" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Working with the DOM</h3>
                <p>Manipulate the structure and content of your webpage dynamically.</p>
            </div>
            <div class="tutorial-step" data-step="8" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Making Animations</h3>
                <p>Create visually appealing animations using CSS and JavaScript.</p>
            </div>
            <div class="tutorial-step" data-step="9" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Improving Your Website</h3>
                <p>Tips and techniques for making your website better.</p>
            </div>
            <div class="tutorial-step" data-step="10" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Next Steps & Resources</h3>
                <p>Congratulations on creating your first website! Here are some tips for continuing your web development journey:</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Tips for Improving:</h4>
                    <ol style="padding-left: 20px; line-height: 1.6;">
                        <li>Add more pages to your website and link them together</li>
                        <li>Learn about responsive design to make your site mobile-friendly</li>
                        <li>Experiment with CSS animations and transitions</li>
                        <li>Try incorporating JavaScript for interactivity</li>
                        <li>Use the browser's developer tools to inspect and debug your code</li>
                    </ol>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Helpful Resources:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><a href="https://www.w3schools.com/" target="_blank">W3Schools</a> - Comprehensive tutorials and references</li>
                        <li><a href="https://developer.mozilla.org/en-US/" target="_blank">MDN Web Docs</a> - Detailed documentation for web technologies</li>
                        <li><a href="https://css-tricks.com/" target="_blank">CSS-Tricks</a> - Tips and tricks for CSS</li>
                        <li><a href="https://hackclub.com/" target="_blank">Hack Club</a> - Community and resources for young developers</li>
                    </ul>
                </div>

                <p style="margin-top: 20px; font-weight: bold;">Remember to save and deploy your site to share it with others!</p>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="openYSWSModal()" class="btn-primary" style="display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #8c52ff 100%);">
                        <i class="fa-solid fa-gift"></i> Apply for YSWS
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ysws-widget">
    <div class="orphy-header" style="background: linear-gradient(135deg, #ff6b6b 0%, #8c52ff 100%); cursor: grab; border-radius: 12px 12px 0 0;">
        <div class="orphy-title">
            <h2>You Ship, We Ship <span class="orphy-emoji">🎁</span></h2>
        </div>
        <button class="orphy-close-btn" onclick="closeYSWSModal()">&times;</button>
    </div>
    <div style="overflow-y: auto; max-height: 70vh; background-color: white; padding: 20px; border-radius: 0 0 12px 12px;">
        <div class="ysws-section" style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #ff6b6b;">
            <h3 style="color: #ff6b6b; margin-top: 0;"><i class="fa-solid fa-mug-hot"></i> Boba Drops</h3>
            <p style="font-size: 16px; line-height: 1.5;">Ship a website, get $5 for Boba!</p>

            <div style="margin: 15px 0; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h4 style="margin-top: 0;">Requirements:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>You're a high schooler (or younger)</li>
                    <li>The website was made recently</li>
                    <li>Your website is a static site (uses HTML + CSS)</li>
                    <li>Your website has text, color and an image</li>
                    <li>You haven't gotten Boba Drops before</li>
                    <li>You are in the USA!</li>
                </ul>
            </div>

            <a href="https://forms.hackclub.com/t/tLf8GYVBqSus" target="_blank" class="btn-primary" style="display: inline-block; margin-top: 15px; text-decoration: none; padding: 10px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%); color: white; border-radius: 8px; font-weight: bold; transition: all 0.2s ease;">
                <i class="fas fa-external-link-alt"></i> Apply for Boba Drops
            </a>
        </div>

        <div class="ysws-section" style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #8c52ff;">
            <h3 style="color: #8c52ff; margin-top: 0;"><i class="fa-solid fa-ice-cream"></i> Swirl</h3>
            <p style="font-size: 16px; line-height: 1.5;">Build a website, Get free ice cream!</p>

            <div style="margin: 15px 0; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h4 style="margin-top: 0;">Requirements:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>You're a high schooler (or younger)</li>
                    <li>The website was made recently</li>
                    <li>Your website is a static site (uses HTML + CSS)</li>
                    <li>Your website has text, color, and an image</li>
                    <li>Your website includes: 3 html pages, a favicon, at least 5 html tags</li>
                    <li>Your website contains at least one scoop</li>
                    <li>You haven't gotten a Swirl Grant before</li>
                    <li>If your website was submitted for Boba Drops, it has been expanded</li>
                    <li>Your website is original (NO AI or copy-pasting from ANYWHERE)</li>
                </ul>
            </div>

            <a href="https://forms.hackclub.com/t/t1UL6ZK4Nyus" target="_blank" class="btn-primary" style="display: inline-block; margin-top: 15px; text-decoration: none; padding: 10px 20px; background: linear-gradient(135deg, #8c52ff 0%, #a56fff 100%); color: white; border-radius: 8px; font-weight: bold; transition: all 0.2s ease;">
                <i class="fas fa-external-link-alt"></i> Apply for Swirl
            </a>
        </div>

        <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 12px;">
            <h4 style="margin-top: 0; color: #ff9d00;"><i class="fas fa-lightbulb"></i> Quick Tip</h4>
            <p>Remember to save and deploy your site before applying. Good luck!</p>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/scroll/annotatescrollbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/match-highlighter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.min.js"></script>

{% if site.site_type == 'web' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/xml-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<script src="{{ url_for('static', filename='js/github.js') }}"></script>
{% elif site.site_type == 'python' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/python-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/indent-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<script src="{{ url_for('static', filename='js/github.js') }}"></script>
{% endif %}

<script src="{{ url_for('static', filename='js/editor-core.js') }}"></script>
<script src="{{ url_for('static', filename='js/ui-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/orphy.js') }}"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
<script src="{{ url_for('static', filename='js/file-handling.js') }}"></script>
{% if current_user.wakatime_api_key %}
<script src="{{ url_for('static', filename='js/hackatime-tracker.js') }}"></script>
{% endif %}

<script>
function openYSWSModal() {
    const widget = document.getElementById('ysws-widget');
    widget.style.display = 'block';

    // Center the modal initially
    const windowHeight = window.innerHeight;
    const windowWidth = window.innerWidth;
    const modalWidth = 500; // Fixed width
    const modalHeight = 600; // Approximate height

    widget.style.left = (windowWidth / 2 - modalWidth / 2) + 'px';
    widget.style.top = (windowHeight / 2 - modalHeight / 2) + 'px';
    widget.style.transform = 'none';

    setTimeout(() => {
        widget.style.opacity = '1';
    }, 50);

    const dragHandle = widget.querySelector('.orphy-header');
    makeDraggable(widget, dragHandle);
}

function openTutorialModal() {
    const widget = document.getElementById('tutorial-widget');
    widget.style.display = 'block';

    // Center the modal initially
    const windowHeight = window.innerHeight;
    const windowWidth = window.innerWidth;
    const modalWidth = 600; // Fixed width
    const modalHeight = 600; // Approximate height

    widget.style.left = (windowWidth / 2 - modalWidth / 2) + 'px';
    widget.style.top = (windowHeight / 2 - modalHeight / 2) + 'px';
    widget.style.transform = 'none';

    setTimeout(() => {
        widget.style.opacity = '1';
    }, 50);

    const dragHandle = widget.querySelector('.orphy-header');
    makeDraggable(widget, dragHandle);

    // Reset to first step
    currentTutorialStep = 1;
    updateTutorialStep();
}

function closeTutorialModal() {
    const widget = document.getElementById('tutorial-widget');
    widget.style.opacity = '0';
    setTimeout(() => {
        widget.style.display = 'none';
    }, 300);
}

let currentTutorialStep = 1;
const totalTutorialSteps = 10;

function nextTutorialStep() {
    if (currentTutorialStep < totalTutorialSteps) {
        currentTutorialStep++;
        updateTutorialStep();
    }
}

function prevTutorialStep() {
    if (currentTutorialStep > 1) {
        currentTutorialStep--;
        updateTutorialStep();
    }
}

function updateTutorialStep() {
    // Update step indicator
    document.getElementById('tutorial-step-indicator').textContent = `${currentTutorialStep}/${totalTutorialSteps}`;

    // Enable/disable navigation buttons
    document.getElementById('prev-tutorial').disabled = (currentTutorialStep === 1);
    document.getElementById('next-tutorial').disabled = (currentTutorialStep === totalTutorialSteps);

    // Show current step, hide others
    document.querySelectorAll('.tutorial-step').forEach(step => {
        const stepNum = parseInt(step.getAttribute('data-step'));
        step.style.display = (stepNum === currentTutorialStep) ? 'block' : 'none';
    });
}

function closeYSWSModal() {
    const widget = document.getElementById('ysws-widget');
    widget.style.opacity = '0';
    setTimeout(() => {
        widget.style.display = 'none';
    }, 300);
}

function makeDraggable(element, dragHandle) {
    let offsetX = 0, offsetY = 0;
    let isDragging = false;

    const startDrag = function(e) {
        isDragging = true;
        const rect = element.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        dragHandle.style.cursor = 'grabbing';
        e.preventDefault();
    };

    const moveDrag = function(e) {
        if (!isDragging) return;

        const x = e.clientX - offsetX;
        const y = e.clientY - offsetY;

        // Set boundaries to keep the modal within viewport
        const maxX = window.innerWidth - element.offsetWidth;
        const maxY = window.innerHeight - element.offsetHeight;

        element.style.left = Math.min(Math.max(0, x), maxX) + 'px';
        element.style.top = Math.min(Math.max(0, y), maxY) + 'px';
        element.style.transform = 'none';
        e.preventDefault();
    };

    const endDrag = function() {
        isDragging = false;
        dragHandle.style.cursor = 'grab';
    };

    dragHandle.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', moveDrag);
    document.addEventListener('mouseup', endDrag);
}
</script>

{% if additional_scripts %}
{{ additional_scripts|safe }}
{% endif %}
{% endblock %}